<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ata Operacional Porter - 2026</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #1a3a5f;
            --accent: #e67e22;
            --bg: #f0f2f5;
            --white: #ffffff;
            --danger: #e74c3c;
            --success: #27ae60;
            --warning: #f39c12;
            --info: #3498db;
            --gray: #7f8c8d;
            --sidebar-width: 280px;
            --header-height: 70px;
        }

        * {
            box-sizing: border-box;
            font-family: 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 0;
        }

        body {
            background: var(--bg);
            color: #333;
            min-height: 100vh;
            display: flex;
        }

        input:-webkit-autofill,
        input:-webkit-autofill:hover,
        input:-webkit-autofill:focus,
        input:-webkit-autofill:active {
            -webkit-box-shadow: 0 0 0 30px white inset !important;
            box-shadow: 0 0 0 30px white inset !important;
            -webkit-text-fill-color: #333 !important;
        }

        /* SIDEBAR */
        #sidebar {
            width: var(--sidebar-width);
            background: white;
            border-right: 1px solid #e0e0e0;
            height: 100vh;
            position: fixed;
            left: 0;
            top: 0;
            overflow-y: auto;
            box-shadow: 2px 0 10px rgba(0,0,0,0.05);
            z-index: 99;
            transition: transform 0.3s ease;
            transform: translateX(-100%);
            display: none;
        }

        @media (min-width: 1200px) {
            #sidebar {
                transform: translateX(0);
                display: block;
            }
            #main-content {
                margin-left: var(--sidebar-width);
            }
        }

        #sidebar.show {
            transform: translateX(0);
            display: block;
        }

        .sidebar-header {
            padding: 1.5rem;
            background: linear-gradient(135deg, var(--primary) 0%, #2c3e50 100%);
            color: white;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .sidebar-header h3 {
            font-size: 1.1rem;
            font-weight: 600;
        }

        .sidebar-toggle {
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            width: 32px;
            height: 32px;
            border-radius: 6px;
            cursor: pointer;
            display: none;
        }

        @media (max-width: 1200px) {
            .sidebar-toggle {
                display: block;
            }
        }

        .condo-list {
            padding: 1rem 0;
        }

        .condo-item {
            padding: 0.9rem 1.5rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
            cursor: pointer;
            transition: all 0.2s;
            border-left: 3px solid transparent;
        }

        .condo-item:hover {
            background: #f8f9fa;
        }

        .condo-item.active {
            background: #e8f4fc;
            border-left-color: var(--accent);
            font-weight: 600;
            color: var(--primary);
        }

        .condo-name {
            flex: 1;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .condo-badge {
            background: var(--danger);
            color: white;
            font-size: 0.7rem;
            padding: 2px 6px;
            border-radius: 10px;
            min-width: 18px;
            text-align: center;
            display: none;
        }

        .condo-badge.has-notification {
            display: block;
            animation: pulse 2s infinite;
        }

        /* CONTE√öDO PRINCIPAL */
        #main-content {
            flex: 1;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            transition: margin-left 0.3s ease;
        }

        @media (max-width: 1200px) {
            #main-content {
                margin-left: 0;
            }
        }

        /* HEADER */
        header {
            background: linear-gradient(135deg, var(--primary) 0%, #2c3e50 100%);
            color: white;
            padding: 0.8rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            min-height: var(--header-height);
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .mobile-toggle {
            display: none;
            background: rgba(255,255,255,0.1);
            border: none;
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.2rem;
        }

        @media (max-width: 768px) {
            .mobile-toggle {
                display: block;
            }
        }

        .header-logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        /* LOGO SEM FUNDO */
        .logo-porter {
            width: 160px;
            height: 40px;
            background-image: url('https://managing-azure-iu7mo6meja.edgeone.dev/Porter_Horizontal_Preto__1__page-0001-removebg-preview.png');
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
            padding: 5px 10px;
            border-radius: 6px;
        }

        .header-logo-text {
            display: flex;
            flex-direction: column;
        }

        .header-logo-text strong {
            font-size: 1.2rem;
        }

        .header-logo-text div {
            font-size: 0.75rem;
            opacity: 0.9;
        }

        /* OPERADORES ONLINE - CORRIGIDO */
        .online-users-dropdown {
            cursor: pointer;
            padding: 8px 12px;
            background: rgba(255,255,255,0.1);
            border-radius: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: background 0.2s;
            position: relative;
        }

        .online-users-dropdown:hover {
            background: rgba(255,255,255,0.2);
        }

        /* üîß FIX 3: MELHORAR ESTILOS DA LISTA DE ONLINE */
        .online-users-list {
            position: absolute;
            top: 100%;
            right: 0;
            width: 300px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.15);
            z-index: 1000;
            max-height: 400px;
            overflow-y: auto;
            margin-top: 5px;
            display: none;
            padding: 0;
            border: 1px solid #e0e0e0;
        }

        .online-user-item {
            padding: 12px 15px;
            display: flex;
            align-items: center;
            gap: 10px;
            border-bottom: 1px solid #f0f0f0;
            transition: background 0.2s;
            cursor: default;
        }

        .online-user-item:last-child {
            border-bottom: none;
        }

        .online-user-item:hover {
            background: #f8f9fa;
        }

        .online-user-avatar {
            width: 38px;
            height: 38px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.3rem;
            background: #e8f4fc;
            color: var(--primary);
            flex-shrink: 0;
        }

        .online-user-info {
            flex: 1;
            min-width: 0;
        }

        .online-user-name {
            font-weight: 600;
            font-size: 0.9rem;
            color: #333;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .online-user-role {
            font-size: 0.75rem;
            color: #666;
            margin-top: 2px;
        }

        .online-status {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #2ecc71;
            animation: pulse 2s infinite;
            flex-shrink: 0;
        }

        /* √ÅREA DE INFORMA√á√ïES DO USU√ÅRIO */
        #user-info {
            background: rgba(255,255,255,0.1);
            padding: 0.8rem 1.2rem;
            border-radius: 8px;
            font-size: 0.9rem;
            display: flex;
            flex-direction: column;
            gap: 4px;
            min-width: 220px;
        }

        @media (max-width: 768px) {
            #user-info {
                min-width: auto;
                width: 100%;
                text-align: center;
                margin-top: 10px;
            }
        }

        .user-info-name {
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .user-info-time {
            font-size: 0.8rem;
            opacity: 0.9;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .user-info-role {
            font-size: 0.75rem;
            opacity: 0.8;
            background: rgba(255,255,255,0.15);
            padding: 2px 8px;
            border-radius: 4px;
            display: inline-block;
            margin-top: 2px;
        }

        /* NOTIFICA√á√ïES */
        .notification-bell {
            position: relative;
            cursor: pointer;
            font-size: 1.3rem;
            color: white;
            padding: 8px;
            border-radius: 6px;
            background: rgba(255,255,255,0.1);
        }

        /* FIX: altera√ß√£o da cor da notifica√ß√£o para azul escuro */
        .notification-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: #0a1e3f; /* azul escuro elegante - AJUSTADO */
            color: white;
            font-size: 0.7rem;
            padding: 2px 6px;
            border-radius: 10px;
            min-width: 18px;
            text-align: center;
            animation: pulse 2s infinite;
        }

        .notifications-panel {
            position: absolute;
            top: 100%;
            right: 0;
            width: 350px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.15);
            z-index: 1000;
            display: none;
            max-height: 400px;
            overflow-y: auto;
        }

        .notifications-panel.show {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        .notification-header {
            padding: 1rem;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: #f8f9fa;
            border-radius: 10px 10px 0 0;
            color: #333;
        }

        .notification-header strong {
            color: var(--primary);
        }

        .notification-item {
            padding: 1rem;
            border-bottom: 1px solid #f0f0f0;
            cursor: pointer;
            transition: background 0.2s;
            background: white;
            color: #333;
        }

        .notification-item:hover {
            background: #f8f9fa;
        }

        .notification-item.unread {
            background: #e8f4fc !important;
            border-left: 4px solid var(--info);
            color: #333;
        }

        .notification-item.destaque {
            background: #e8f4fc !important;
            border-left: 4px solid #3498db;
            color: #333;
        }

        .notification-condo {
            font-weight: 600;
            color: var(--primary);
            margin-bottom: 5px;
            font-size: 0.95rem;
        }

        .notification-time {
            font-size: 0.8rem;
            color: var(--gray);
        }

        /* TABS */
        .tabs {
            display: flex;
            background: white;
            padding: 0 2rem;
            gap: 0.5rem;
            border-bottom: 2px solid #e0e0e0;
            overflow-x: auto;
            white-space: nowrap;
        }

        @media (max-width: 768px) {
            .tabs {
                padding: 0 1rem;
            }
        }

        .tab-btn {
            padding: 1rem 1.8rem;
            border: none;
            background: none;
            cursor: pointer;
            font-weight: 600;
            color: #666;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        @media (max-width: 768px) {
            .tab-btn {
                padding: 0.8rem 1rem;
                font-size: 0.9rem;
            }
        }

        .tab-btn.active {
            color: var(--accent);
            border-bottom-color: var(--accent);
            background-color: rgba(230, 126, 34, 0.05);
        }

        .tab-btn:hover:not(.active) {
            background-color: rgba(0,0,0,0.03);
        }

        .tab-badge {
            background: var(--accent);
            color: white;
            font-size: 0.7rem;
            padding: 2px 6px;
            border-radius: 10px;
            margin-left: 5px;
        }

        .chat-badge {
            background: var(--info);
            color: white;
            font-size: 0.7rem;
            padding: 2px 6px;
            border-radius: 10px;
            margin-left: 5px;
            min-width: 20px;
            height: 20px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }

        /* CONTAINER PRINCIPAL */
        .container {
            flex: 1;
            padding: 2rem;
            max-width: 1400px;
            margin: 0 auto;
            width: 100%;
        }

        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }
        }

        /* COMPONENTE DE HUMOR */
        .mood-check-container {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            padding: 1.5rem;
            border-radius: 12px;
            margin-bottom: 1.5rem;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
            border-left: 4px solid var(--accent);
            border-right: 4px solid var(--accent);
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .mood-check-container::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #e74c3c, #e67e22, #f1c40f, #2ecc71, #27ae60);
        }

        .mood-title {
            color: var(--primary);
            font-size: 1.2rem;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .mood-subtitle {
            color: var(--gray);
            font-size: 0.9rem;
            margin-bottom: 1.5rem;
            font-style: italic;
        }

        .mood-options {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 1.5rem 0;
            flex-wrap: wrap;
        }

        @media (max-width: 768px) {
            .mood-options {
                gap: 10px;
            }
        }

        .mood-option {
            display: flex;
            flex-direction: column;
            align-items: center;
            cursor: pointer;
            transition: all 0.3s;
            padding: 12px;
            border-radius: 12px;
            min-width: 90px;
            background: rgba(255,255,255,0.8);
            border: 2px solid transparent;
        }

        @media (max-width: 768px) {
            .mood-option {
                min-width: 75px;
                padding: 8px;
            }
        }

        .mood-option:hover {
            background: white;
            transform: translateY(-5px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.1);
        }

        .mood-option.selected {
            background: white;
            box-shadow: 0 4px 15px rgba(0,0,0,0.15);
            transform: scale(1.05);
            border-color: currentColor;
        }

        .mood-face {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            border: 3px solid;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 10px;
            position: relative;
            background: white;
            transition: all 0.3s;
        }

        @media (max-width: 768px) {
            .mood-face {
                width: 65px;
                height: 65px;
            }
        }

        .mood-option.selected .mood-face {
            transform: scale(1.1);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        .mood-face svg {
            width: 45px;
            height: 45px;
        }

        @media (max-width: 768px) {
            .mood-face svg {
                width: 35px;
                height: 35px;
            }
        }

        .mood-label {
            font-size: 0.85rem;
            font-weight: 700;
            color: #333;
            margin-top: 5px;
            text-align: center;
            min-height: 40px;
            display: flex;
            align-items: center;
        }

        @media (max-width: 768px) {
            .mood-label {
                font-size: 0.8rem;
                min-height: 35px;
            }
        }

        .mood-description {
            font-size: 0.8rem;
            color: var(--gray);
            margin-top: 5px;
            font-style: italic;
            min-height: 20px;
        }

        .mood-status {
            font-size: 1rem;
            color: var(--primary);
            font-weight: 600;
            margin-top: 10px;
            min-height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .mood-submit {
            margin-top: 1.5rem;
        }

        .mood-result {
            background: white;
            padding: 1.2rem;
            border-radius: 8px;
            margin-top: 1rem;
            border: 2px solid var(--success);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            animation: fadeIn 0.5s ease-out;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        .mood-result i {
            color: var(--success);
            font-size: 1.3rem;
        }

        /* CHAT GERAL */
        .chat-container {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            height: 500px;
        }

        @media (max-width: 768px) {
            .chat-container {
                height: 400px;
            }
        }

        .chat-header {
            background: linear-gradient(135deg, var(--primary) 0%, #2c3e50 100%);
            color: white;
            padding: 1rem 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 1.5rem;
            display: flex;
            flex-direction: column;
            gap: 1rem;
            background: #f8f9fa;
        }

        /* FIX: scroll do chat otimizado */
        .chat-messages {
            scroll-behavior: smooth;
            -webkit-overflow-scrolling: touch;
        }

        .chat-message {
            max-width: 80%;
            padding: 0.8rem 1rem;
            border-radius: 12px;
            position: relative;
        }

        @media (max-width: 768px) {
            .chat-message {
                max-width: 90%;
            }
        }

        .chat-message.sent {
            align-self: flex-end;
            background: var(--info);
            color: white;
            border-bottom-right-radius: 4px;
        }

        .chat-message.received {
            align-self: flex-start;
            background: white;
            color: #333;
            border: 1px solid #e0e0e0;
            border-bottom-left-radius: 4px;
        }

        .chat-message-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
            font-size: 0.85rem;
        }

        .chat-message-sender {
            font-weight: 600;
        }

        .chat-message-time {
            opacity: 0.8;
        }

        .chat-message-text {
            word-wrap: break-word;
            line-height: 1.4;
        }

        .chat-input-area {
            padding: 1rem 1.5rem;
            border-top: 1px solid #e0e0e0;
            background: white;
            display: flex;
            gap: 10px;
        }

        @media (max-width: 768px) {
            .chat-input-area {
                padding: 0.8rem;
            }
        }

        .chat-input {
            flex: 1;
            padding: 0.8rem 1rem;
            border: 1px solid #ddd;
            border-radius: 8px;
            resize: none;
            font-size: 0.95rem;
            font-family: inherit;
        }

        .chat-input:focus {
            outline: none;
            border-color: var(--info);
            box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2);
        }

        .chat-admin-controls {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .chat-clear-btn {
            background: var(--danger);
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.85rem;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        /* FORMUL√ÅRIOS E FILTROS */
        .filters-container {
            background: white;
            padding: 1.5rem;
            border-radius: 12px;
            margin-bottom: 1.5rem;
            box-shadow: 0 4px 10px rgba(0,0,0,0.05);
            border-left: 4px solid var(--primary);
        }

        .filters-title {
            color: var(--primary);
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.1rem;
        }

        .grid-2 {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
        }

        .grid-3 {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        @media (max-width: 768px) {
            .grid-2, .grid-3 {
                grid-template-columns: 1fr;
            }
        }

        .filter-actions {
            display: flex;
            gap: 10px;
            align-items: flex-end;
        }

        @media (max-width: 768px) {
            .filter-actions {
                flex-direction: column;
            }
            .filter-actions .btn {
                width: 100%;
            }
        }

        .form-group { margin-bottom: 1.4rem; }

        label { display: block; margin-bottom: 0.5rem; font-weight: 600; color: #444; }

        input, select, textarea {
            width: 100%;
            padding: 0.9rem;
            border: 1.5px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.3s;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(230, 126, 34, 0.2);
        }

        .input-icon {
            position: relative;
        }

        .input-icon i {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--gray);
        }

        .input-icon input, .input-icon select {
            padding-left: 45px;
        }

        /* üîß FIX 1: MELHORAR ESTILOS DO SELECT DO CHAT PRIVADO */
        #private-chat-target {
            width: 100%;
            padding: 10px 15px;
            border: 1.5px solid #ddd;
            border-radius: 8px;
            font-size: 0.95rem;
            transition: all 0.3s;
            background: white;
            cursor: pointer;
        }

        #private-chat-target:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2);
        }

        #private-chat-target option {
            padding: 8px;
            font-size: 0.9rem;
        }

        #private-chat-target option:checked {
            background: #3498db linear-gradient(0deg, #3498db 0%, #3498db 100%);
            color: white;
        }

        /* BOT√ïES */
        .btn {
            padding: 0.9rem 1.8rem;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary) 0%, #2c3e50 100%);
            color: white;
            width: 100%;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(26, 58, 95, 0.4);
        }

        .btn-accent {
            background: linear-gradient(135deg, var(--accent) 0%, #d35400 100%);
            color: white;
        }

        .btn-accent:hover {
            background: linear-gradient(135deg, #d35400 0%, var(--accent) 100%);
        }

        .btn-danger {
            background: var(--danger);
            color: white;
            padding: 0.5rem 1rem;
            font-size: 0.85rem;
        }

        .btn-danger:hover {
            background: #c0392b;
        }

        .btn-filter {
            background: var(--primary);
            color: white;
            padding: 0.8rem 1.5rem;
            font-size: 0.9rem;
        }

        .btn-filter:hover {
            background: #2c3e50;
            transform: translateY(-2px);
        }

        .btn-clear {
            background: var(--gray);
            color: white;
            padding: 0.8rem 1.5rem;
            font-size: 0.9rem;
        }

        .btn-clear:hover {
            background: #5d6d7e;
        }

        .btn-success {
            background: var(--success);
            color: white;
            padding: 0.8rem 1.5rem;
        }

        .btn-success:hover {
            background: #229954;
        }

        .btn-info {
            background: var(--info);
            color: white;
            padding: 0.8rem 1.5rem;
        }

        .btn-info:hover {
            background: #2980b9;
        }

        .btn-warning {
            background: var(--warning);
            color: white;
            padding: 0.5rem 1rem;
            font-size: 0.85rem;
        }

        /* CARDS DE ATA */
        .ata-card {
            background: white;
            padding: 1.5rem;
            border-radius: 10px;
            margin-bottom: 1.2rem;
            box-shadow: 0 4px 8px rgba(0,0,0,0.08);
            border-left: 5px solid var(--accent);
            position: relative;
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .ata-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.1);
        }

        .ata-card.fixed {
            border-left-color: var(--warning);
            background: linear-gradient(to right, #fff3cd10, white);
        }

        .ata-card.os {
            border-left-color: var(--info);
            background: linear-gradient(to right, #d6eaf810, white);
        }

        .ata-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.8rem;
            font-size: 0.85rem;
            color: var(--gray);
        }

        .ata-condo {
            font-size: 1.3rem;
            font-weight: bold;
            color: var(--primary);
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .status-badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.75rem;
            text-transform: uppercase;
            font-weight: bold;
            display: inline-flex;
            align-items: center;
            gap: 5px;
        }

        .status-finalizado { background: #d4edda; color: #155724; }
        .status-andamento { background: #fff3cd; color: #856404; }
        .status-fixo { background: #e8f4fc; color: #1a3a5f; }
        .status-os { background: #d6eaf8; color: #1b4f72; }

        .ata-type {
            display: inline-block;
            padding: 3px 10px;
            background: #e8f4fc;
            color: #1a3a5f;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: 600;
            margin: 5px 0 10px 0;
            display: inline-flex;
            align-items: center;
            gap: 5px;
        }

        .ata-type.fixed {
            background: #fff3cd;
            color: #856404;
        }

        .ata-type.os {
            background: #d6eaf8;
            color: #1b4f72;
        }

        /* RESPOSTAS/COMENT√ÅRIOS */
        .comment-form {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin: 1.5rem 0;
            padding: 1rem;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .comment-form textarea {
            width: 100%;
            min-height: 100px;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            resize: vertical;
            font-family: inherit;
            font-size: 0.95rem;
        }

        .comment-form textarea:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 2px rgba(230, 126, 34, 0.1);
        }

        .comment-form button {
            align-self: flex-end;
        }

        .comment-list {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            margin-top: 1rem;
        }

        .comment-item {
            background: #f8f9fa;
            padding: 1rem;
            border-radius: 8px;
            border-left: 3px solid var(--accent);
        }

        .comment-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.5rem;
            font-size: 0.9rem;
        }

        .comment-author {
            font-weight: 600;
            color: var(--primary);
        }

        .comment-time {
            color: var(--gray);
            font-size: 0.8rem;
        }

        .comment-text {
            white-space: pre-wrap;
            line-height: 1.5;
        }

        /* FORMUL√ÅRIO OS */
        .form-card {
            background: white;
            padding: 1.8rem;
            border-radius: 12px;
            margin-bottom: 2rem;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            border-top: 4px solid var(--accent);
        }

        .form-card.os-form {
            border-top-color: var(--info);
        }

        .form-card h2 {
            margin-top: 0;
            margin-bottom: 1.5rem;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* ABA DE INFORMA√á√ïES FIXAS */
        .fixed-info-container {
            background: #fff3cd20;
            border: 1px solid #fff3cd;
            border-radius: 10px;
            padding: 1.5rem;
            margin-bottom: 2rem;
        }

        .fixed-info-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 1rem;
            color: #856404;
        }

        /*  SCREEN */
        #login-screen {
            min-height: 100vh;
            display: flex !important;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, var(--primary) 0%, #2c3e50 100%);
            padding: 20px;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            z-index: 1000;
            transition: opacity 0.3s ease;
        }

        #login-screen.hidden {
            opacity: 0;
            pointer-events: none;
            z-index: -1;
            display: none !important;
        }

        .login-container {
            background: rgba(255, 255, 255, 0.95);
            padding: 2.5rem;
            border-radius: 16px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.25);
            width: 100%;
            max-width: 420px;
            border-top: 5px solid var(--accent);
            position: relative;
            overflow: hidden;
        }

        .login-container::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 5px;
            background: linear-gradient(90deg, var(--accent), #f39c12);
        }

        .login-logo {
            text-align: center;
            margin-bottom: 1.5rem;
        }

        .login-logo h1 {
            color: var(--primary);
            margin: 1rem 0 0.5rem 0;
            font-size: 1.5rem;
        }

        .login-logo p {
            color: var(--gray);
            font-size: 0.9rem;
        }

        /* LOGO IMAGEM NO LOGIN - SEM FUNDO */
        .login-logo-img {
            width: 180px;
            height: 50px;
            margin: 0 auto 1.2rem;
            background-image: url('https://managing-azure-iu7mo6meja.edgeone.dev/Porter_Horizontal_Preto__1__page-0001-removebg-preview.png');
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
        }

        /* UTILIT√ÅRIOS */
        .hidden {
            display: none !important;
        }

        .visible {
            display: block !important;
        }

        .fade-in { animation: fadeIn 0.5s ease-out; }

        .empty-state {
            text-align: center;
            padding: 3rem;
            color: var(--gray);
            background: white;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.05);
        }

        .no-results {
            text-align: center;
            padding: 2rem;
            background: white;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.05);
            color: var(--gray);
        }

        .active-filters {
            background: #e8f4fc;
            padding: 0.8rem;
            border-radius: 8px;
            margin-bottom: 1rem;
            font-size: 0.9rem;
            color: var(--primary);
            border-left: 3px solid var(--accent);
        }

        .active-filters span {
            background: var(--accent);
            color: white;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
            margin-left: 5px;
        }

        /* ANIMA√á√ïES */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        @keyframes slideIn {
            from { transform: translateX(-20px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        /* MODAL */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s;
        }

        .modal.show {
            opacity: 1;
            visibility: visible;
        }

        .modal-content {
            background: white;
            border-radius: 12px;
            padding: 2rem;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            transform: translateY(-20px);
            transition: transform 0.3s;
        }

        .modal.show .modal-content {
            transform: translateY(0);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid #eee;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--gray);
        }

        /* CONTROLES ADMIN */
        .admin-controls {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .admin-btn {
            background: var(--warning);
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.85rem;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .force-logoff-btn {
            background: var(--danger);
        }

        .force-logoff-btn:hover {
            background: #c0392b;
        }

        /* TABELAS */
        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 4px 8px rgba(0,0,0,0.05);
        }

        table th {
            background: var(--primary);
            color: white;
            padding: 1rem;
            text-align: left;
            font-weight: 600;
        }

        table td {
            padding: 1rem;
            border-bottom: 1px solid #eee;
        }

        table tr:hover {
            background: #f8f9fa;
        }

        @media (max-width: 768px) {
            table {
                display: block;
                overflow-x: auto;
            }
        }

        /* BOT√ïES EM GRUPO */
        .btn-group {
            display: flex;
            border-radius: 8px;
            overflow: hidden;
            border: 1px solid #ddd;
        }

        .btn-group .btn-filter {
            border-radius: 0;
            border-right: 1px solid #ddd;
            margin: 0;
        }

        .btn-group .btn-filter:last-child {
            border-right: none;
        }

        /* TOOLTIPS */
        .tooltip {
            position: relative;
            display: inline-block;
        }

        .tooltip .tooltip-text {
            visibility: hidden;
            width: 200px;
            background-color: #333;
            color: white;
            text-align: center;
            border-radius: 6px;
            padding: 8px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%);
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 0.85rem;
            font-weight: normal;
        }

        .tooltip:hover .tooltip-text {
            visibility: visible;
            opacity: 1;
        }

        /* PDF PREVIEW */
        .pdf-preview {
            background: white;
            border: 2px dashed #ddd;
            border-radius: 10px;
            padding: 2rem;
            margin-top: 1rem;
            text-align: center;
            min-height: 200px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .pdf-icon {
            font-size: 3rem;
            color: var(--danger);
            margin-bottom: 1rem;
        }

        /* LOADING */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid var(--accent);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* BOT√ÉO DESABILITADO */
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
        }

        /* ESTILOS PARA CHAT VISTO POR */
        .chat-visto-por {
            transition: all 0.3s ease;
        }

        .chat-visto-por:hover {
            background: #e8f4fc !important;
            transform: translateY(-2px);
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        /* ANIMA√á√ÉO PARA NOVAS MENSAGENS */
        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% {transform: translateY(0);}
            40% {transform: translateY(-5px);}
            60% {transform: translateY(-3px);}
        }

        .chat-badge {
            animation: bounce 1s;
            min-width: 20px;
            height: 20px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }

        /* ESTILO PARA BADGE VAZIO */
        .chat-badge:empty {
            display: none !important;
        }

        /* ESTILO PARA ABA COM NOVA MENSAGEM */
        .chat-tab.has-new-message {
            position: relative;
            animation: pulseTab 2s infinite;
        }

        .chat-tab.has-new-message::after {
            content: '';
            position: absolute;
            top: 10px;
            right: 10px;
            width: 8px;
            height: 8px;
            background: #e74c3c;
            border-radius: 50%;
            animation: pulseDot 1.5s infinite;
        }

        @keyframes pulseTab {
            0% { background-color: rgba(52, 152, 219, 0.05); }
            50% { background-color: rgba(52, 152, 219, 0.15); }
            100% { background-color: rgba(52, 152, 219, 0.05); }
        }

        @keyframes pulseDot {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.3); opacity: 0.7; }
            100% { transform: scale(1); opacity: 1; }
        }

        /* DESTAQUE PARA MENSAGEM ESPEC√çFICA */
        .mensagem-destacada {
            animation: highlightPulse 3s ease-in-out;
            border: 2px solid #e67e22 !important;
            background: #fff9e6 !important;
            position: relative;
        }

        .mensagem-destacada::before {
            content: 'üîî Nova mensagem';
            position: absolute;
            top: -25px;
            left: 50%;
            transform: translateX(-50%);
            background: #e67e22;
            color: white;
            padding: 3px 10px;
            border-radius: 4px;
            font-size: 0.7rem;
            font-weight: bold;
            white-space: nowrap;
        }

        @keyframes highlightPulse {
            0% { box-shadow: 0 0 0 0 rgba(230, 126, 34, 0.7); }
            70% { box-shadow: 0 0 0 15px rgba(230, 126, 34, 0); }
            100% { box-shadow: 0 0 0 0 rgba(230, 126, 34, 0); }
        }

        /* NOVOS ESTILOS PARA CONFIRMA√á√ÉO DE OS */
        .os-confirmation {
            text-align: center;
            padding: 3rem;
            background: white;
            border-radius: 12px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            margin: 2rem 0;
            animation: fadeIn 0.5s ease-out;
            border-top: 5px solid var(--success);
        }

        .os-confirmation i {
            font-size: 4rem;
            color: var(--success);
            margin-bottom: 1.5rem;
            animation: pulse 2s infinite;
        }

        .os-confirmation h2 {
            color: var(--primary);
            margin-bottom: 1rem;
        }

        .os-confirmation .details {
            background: #f8f9fa;
            padding: 1.5rem;
            border-radius: 8px;
            text-align: left;
            margin: 1.5rem 0;
            border-left: 4px solid var(--info);
        }

        .os-confirmation .details strong {
            color: var(--primary);
            display: inline-block;
            min-width: 120px;
        }

        .back-to-os {
            margin-top: 2rem;
        }

        /* NEW: Estilos para chat privado */
        .chat-private-container {
            border: 2px solid #3498db;
            margin-top: 10px;
        }

        .chat-private-header {
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
        }

        .private-chat-selector {
            margin-bottom: 10px;
        }

        .private-chat-selector select {
            padding: 8px;
            border-radius: 6px;
            border: 1px solid #ddd;
            font-size: 0.9rem;
        }

        .chat-private-messages {
            min-height: 200px;
            max-height: 300px;
        }

        .chat-private-controls {
            display: flex;
            gap: 5px;
        }

        /* NOVOS ESTILOS PARA STATUS DE OS */
        .os-status-badge {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: bold;
            display: inline-flex;
            align-items: center;
            gap: 5px;
            margin: 5px;
        }

        .os-status-resolvida { background: #d4edda; color: #155724; }
        .os-status-remotamente { background: #d1ecf1; color: #0c5460; }
        .os-status-espera { background: #fff3cd; color: #856404; }
        .os-status-compareceu { background: #cce5ff; color: #004085; }
        .os-status-condominio { background: #f8d7da; color: #721c24; }
        .os-status-branco { background: #e2e3e5; color: #383d41; }

        /* BOT√ïES DE STATUS */
        .status-action-btn {
            padding: 6px 12px;
            border-radius: 6px;
            border: 1px solid #ddd;
            background: white;
            color: #333;
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            gap: 5px;
            margin: 2px;
        }

        .status-action-btn:hover {
            background: #f8f9fa;
            transform: translateY(-2px);
        }

        .status-action-btn.tec-only {
            background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%);
            color: white;
            border-color: #d35400;
        }

        .status-action-btn.all {
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
            color: white;
            border-color: #2980b9;
        }

        /* LISTA DE T√âCNICOS */
        .tecnicos-container {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            border-left: 4px solid var(--warning);
        }

        /* RESPONSIVIDADE ADICIONAL */
        @media (max-width: 480px) {
            header {
                flex-direction: column;
                gap: 10px;
                padding: 1rem;
            }
            
            .header-left {
                width: 100%;
                justify-content: space-between;
            }
            
            .header-logo-text {
                display: none;
            }
            
            .logo-porter {
                width: 120px;
                height: 30px;
            }
            
            .tabs {
                padding: 0 0.5rem;
            }
            
            .tab-btn {
                padding: 0.6rem 0.8rem;
                font-size: 0.8rem;
            }
            
            .container {
                padding: 0.8rem;
            }
            
            .form-card {
                padding: 1rem;
            }
            
            .mood-option {
                min-width: 70px;
                padding: 6px;
            }
            
            .mood-face {
                width: 50px;
                height: 50px;
            }
            
            .mood-face svg {
                width: 25px;
                height: 25px;
            }
        }

        /* ANIMA√á√ïES ADICIONAIS */
        @keyframes slideUp {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .slide-up {
            animation: slideUp 0.3s ease-out;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
            20%, 40%, 60%, 80% { transform: translateX(5px); }
        }

        .shake {
            animation: shake 0.5s ease-in-out;
        }

        /* ESTILOS PARA SCROLLBAR PERSONALIZADA */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #a8a8a8;
        }

        /* ESTILOS PARA FOCUS VISIBLE */
        :focus-visible {
            outline: 2px solid var(--accent);
            outline-offset: 2px;
        }

        /* ESTILOS PARA DISPOSITIVOS DE TOQUE */
        @media (hover: none) and (pointer: coarse) {
            .btn:hover {
                transform: none !important;
            }
            
            .condo-item:hover {
                background: inherit;
            }
            
            .notification-item:hover {
                background: inherit;
            }
            
            .online-user-item:hover {
                background: inherit;
            }
        }

        /* ESTILOS PARA IMPRESS√ÉO */
        @media print {
            #sidebar,
            header,
            .tabs,
            .mood-check-container,
            .filters-container,
            .form-card,
            .chat-container,
            .chat-input-area,
            .btn {
                display: none !important;
            }
            
            #main-content {
                margin-left: 0 !important;
            }
            
            .container {
                padding: 0;
            }
            
            .ata-card {
                box-shadow: none;
                border: 1px solid #ddd;
                page-break-inside: avoid;
            }
        }
    </style>
</head>
<body>

<!-- TELA DE LOGIN -->
<section id="login-screen">
    <div class="login-container">
        <div class="login-logo">
            <!-- LOGO DA PORTER ATUALIZADA SEM FUNDO -->
            <div class="login-logo-img"></div>
            <h1>Ata Operacional Porter</h1>
            <p>Sistema de Registro de Ocorr√™ncias - 2026</p>
        </div>
        <div class="form-group input-icon">
            <i class="fas fa-user"></i>
            <input type="text" id="login-user" placeholder="nome.sobrenome" autocomplete="off">
        </div>
        <div class="form-group input-icon">
            <i class="fas fa-lock"></i>
            <input type="password" id="login-pass" placeholder="********" autocomplete="off">
        </div>
        <div class="form-group input-icon">
            <i class="fas fa-clock"></i>
            <select id="login-turno">
                <option value="Diurno">Diurno</option>
                <option value="Noturno">Noturno</option>
            </select>
        </div>
        <!-- üîß CORRE√á√ÉO: Bot√£o com ID para ser configurado via JavaScript -->
        <button class="btn btn-primary" id="login-button" onclick=".login()">
    <i class="fas fa-sign-in-alt"></i> ACESSAR SISTEMA
</button>
        <div style="margin-top: 1.5rem; text-align: center; font-size: 0.8rem; color: var(--gray);">
            <i class="fas fa-info-circle"></i> Use suas credenciais fornecidas pela Porter
        </div>
    </div>
</section>

<!-- SIDEBAR COM LISTA DE CONDOM√çNIOS -->
<div id="sidebar">
    <div class="sidebar-header">
        <h3><i class="fas fa-building"></i> CONDOM√çNIOS</h3>
        <button class="sidebar-toggle" onclick=".toggleSidebar()">
            <i class="fas fa-times"></i>
        </button>
    </div>
    <div class="condo-list" id="condo-list">
        <!-- Lista de condom√≠nios ser√° gerada dinamicamente -->
    </div>
</div>

<!-- CONTE√öDO PRINCIPAL -->
<div id="main-content" class="hidden">
    <header>
        <div class="header-left">
            <button class="mobile-toggle" onclick="app.toggleSidebar()">
                <i class="fas fa-bars"></i>
            </button>
            <div class="header-logo">
                <!-- LOGO DA PORTER NO HEADER - ATUALIZADA SEM FUNDO -->
                <div class="logo-porter"></div>
                <div class="header-logo-text">
                    <strong>ATA OPERACIONAL PORTER</strong>
                    <div>Sistema de Registro de Ocorr√™ncias - 2026</div>
                </div>
            </div>
        </div>
        <!-- √ÅREA DE INFORMA√á√ïES DO USU√ÅRIO -->
        <div id="user-info">
            <!-- Ser√° preenchido dinamicamente com informa√ß√µes do login -->
        </div>
        <div style="display: flex; align-items: center; gap: 15px;">
            <!-- OPERADORES ONLINE -->
            <div id="online-users" class="online-users-dropdown">
                <i class="fas fa-users" style="color: white;"></i>
                <span style="font-size: 0.9rem;">
                    <span id="online-count">0</span> online
                </span>
                <i class="fas fa-chevron-down" style="font-size: 0.8rem;"></i>
                <div id="online-users-list" class="online-users-list"></div>
            </div>
            <!-- Notifica√ß√µes -->
            <div class="notification-bell" onclick="app.toggleNotifications()">
                <i class="fas fa-bell"></i>
                <span class="notification-badge" id="notification-count" style="display: none;">0</span>
                <div class="notifications-panel" id="notifications-panel">
                    <div class="notification-header">
                        <strong><i class="fas fa-bell"></i> Notifica√ß√µes</strong>
                        <button class="btn btn-clear btn-sm" onclick="app.clearNotifications()">Limpar</button>
                    </div>
                    <div id="notifications-list"></div>
                </div>
            </div>
            <!-- Bot√£o Relat√≥rio -->
            <button class="btn btn-success" onclick="app.openReportModal()">
                <i class="fas fa-file-pdf"></i> Relat√≥rio
            </button>
            <!-- Bot√£o Admin (apenas para admin) -->
            <div id="admin-controls" class="admin-controls" style="display: none;">
                <button class="btn btn-warning" onclick="app.openAdminPanel()">
                    <i class="fas fa-user-shield"></i> Admin
                </button>
            </div>
            <!-- Bot√£o Sair -->
            <button class="btn btn-accent" onclick="app.logout()">
                <i class="fas fa-sign-out-alt"></i> Sair
            </button>
        </div>
    </header>

    <div class="tabs">
        <button class="tab-btn active" onclick="app.switchTab('tab-ata', this)">
            <i class="fas fa-file-alt"></i> ATA DE OCORR√äNCIAS
            <span class="tab-badge" id="tab-count-ata">0</span>
        </button>
        <button class="tab-btn" onclick="app.switchTab('tab-fixas', this)">
            <i class="fas fa-thumbtack"></i> INFORMA√á√ïES FIXAS
            <span class="tab-badge" id="tab-count-fixas">0</span>
        </button>
        <button class="tab-btn" onclick="app.switchTab('tab-os', this)">
            <i class="fas fa-tools"></i> ORDEM DE SERVI√áO
            <span class="tab-badge" id="tab-count-os">0</span>
        </button>
        <!-- NOVA ABA: CHAT GERAL -->
        <button class="tab-btn chat-tab" onclick="app.switchTab('tab-chat', this)">
            <i class="fas fa-comments"></i> CHAT GERAL
            <span class="chat-badge" id="chat-badge">0</span>
        </button>
        <!-- NEW: Nova aba de chat privado -->
        <button class="tab-btn" onclick="app.switchTab('tab-chat-privado', this)" id="tab-chat-privado-btn">
            <i class="fas fa-user-secret"></i> CHAT PRIVADO
            <span class="chat-badge" id="chat-private-badge">0</span>
        </button>
        <button class="tab-btn" onclick="app.switchTab('tab-presenca', this)">
            <i class="fas fa-users"></i> HIST√ìRICO
        </button>
    </div>

    <div class="container">
        <!-- Componente de Avalia√ß√£o de Humor -->
        <div id="mood-check-container" class="mood-check-container hidden">
            <div class="mood-title">
                <i class="fas fa-heart"></i> Como voc√™ est√° se sentindo hoje?
            </div>
            <div class="mood-subtitle">
                Selecione a express√£o que melhor representa seu estado emocional atual
            </div>
            <div class="mood-options" id="mood-options">
                <!-- As op√ß√µes ser√£o geradas via JavaScript -->
            </div>
            <div class="mood-status" id="mood-status">
                <i class="fas fa-mouse-pointer"></i> Clique em uma express√£o para selecionar
            </div>
            <div class="mood-submit">
                <button class="btn btn-primary" onclick="app.enviarMood()" id="mood-submit-btn" disabled>
                    <i class="fas fa-paper-plane"></i> Enviar Meu Sentimento
                </button>
            </div>
            <div id="mood-result" class="mood-result hidden"></div>
        </div>

        <!-- ABA: ATA DE OCORR√äNCIAS -->
        <div id="tab-ata" class="tab-content">
            <!-- Filtros -->
            <div class="filters-container">
                <div class="filters-title">
                    <i class="fas fa-filter"></i> Filtrar Registros
                </div>
                <div class="grid-3">
                    <div class="form-group">
                        <label><i class="fas fa-building"></i> Condom√≠nio</label>
                        <select id="filter-condo">
                            <option value="">Todos os condom√≠nios</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label><i class="fas fa-calendar"></i> Data Inicial</label>
                        <input type="date" id="filter-data-inicio">
                    </div>
                    <div class="form-group">
                        <label><i class="fas fa-calendar"></i> Data Final</label>
                        <input type="date" id="filter-data-fim">
                    </div>
                    <div class="form-group">
                        <label><i class="fas fa-tag"></i> Tipo</label>
                        <select id="filter-tipo">
                            <option value="">Todos os tipos</option>
                            <option value="Informa√ß√£o">üìù Informa√ß√£o</option>
                            <option value="Ocorr√™ncia">‚ö†Ô∏è Ocorr√™ncia</option>
                            <option value="Incidente">üö® Incidente</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label><i class="fas fa-tasks"></i> Status</label>
                        <select id="filter-status">
                            <option value="">Todos os status</option>
                            <option value="Em andamento">üîÑ Em andamento</option>
                            <option value="Finalizado">‚úÖ Finalizado</option>
                        </select>
                    </div>
                    <div class="filter-actions">
                        <button class="btn btn-filter" onclick="app.aplicarFiltrosAtas()">
                            <i class="fas fa-search"></i> Filtrar
                        </button>
                        <button class="btn btn-clear" onclick="app.limparFiltrosAtas()">
                            <i class="fas fa-times"></i> Limpar
                        </button>
                    </div>
                </div>
                <div id="filtros-ativos-ata" class="filter-info"></div>
            </div>
            <div id="resultados-info-ata" style="margin-bottom: 1rem;"></div>

            <!-- Formul√°rio Nova Ata -->
            <div class="form-card fade-in">
                <h2><i class="fas fa-plus-circle"></i> Novo Registro de Ocorr√™ncia</h2>
                <div class="grid-2">
                    <div class="form-group">
                        <label><i class="fas fa-building"></i> Condom√≠nio</label>
                        <select id="ata-condo" onchange="app.updateCity()">
                            <option value="">Selecione um condom√≠nio...</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label><i class="fas fa-city"></i> Cidade</label>
                        <input type="text" id="ata-cidade" readonly style="background: #f8f9fa;">
                    </div>
                </div>
                <div class="grid-2">
                    <div class="form-group">
                        <label><i class="fas fa-tag"></i> Tipo de Registro</label>
                        <select id="ata-tipo">
                            <option value="Informa√ß√£o">üìù Informa√ß√£o</option>
                            <option value="Ocorr√™ncia">‚ö†Ô∏è Ocorr√™ncia</option>
                            <option value="Incidente">üö® Incidente</option>
                            <option value="Informa√ß√µes Fixas">üìå Informa√ß√µes Fixas</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label><i class="fas fa-tasks"></i> Status</label>
                        <select id="ata-status">
                            <option value="Em andamento">üîÑ Em andamento</option>
                            <option value="Finalizado">‚úÖ Finalizado</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label><i class="fas fa-align-left"></i> Descri√ß√£o dos Fatos</label>
                    <textarea id="ata-desc" rows="5" placeholder="Descreva detalhadamente os fatos ocorridos..."></textarea>
                </div>
                <button class="btn btn-primary" onclick="app.saveAta()">
                    <i class="fas fa-save"></i> SALVAR REGISTRO
                </button>
            </div>

            <!-- Lista de Atas -->
            <div id="ata-lista"></div>
        </div>

        <!-- ABA: INFORMA√á√ïES FIXAS -->
        <div id="tab-fixas" class="tab-content hidden">
            <div class="fixed-info-container">
                <div class="fixed-info-header">
                    <i class="fas fa-thumbtack"></i>
                    <h3>Informa√ß√µes Fixas dos Condom√≠nios</h3>
                </div>
                <p style="color: #856404; margin-bottom: 1rem;">
                    <i class="fas fa-info-circle"></i> Estas s√£o informa√ß√µes importantes que permanecem vis√≠veis para todos os operadores.
                </p>
            </div>
            <div id="fixas-lista"></div>
        </div>

        <!-- ABA: ORDEM DE SERVI√áO -->
        <div id="tab-os" class="tab-content hidden">
            <!-- Tela de Confirma√ß√£o de OS Enviada (oculta por padr√£o) -->
            <div id="os-confirmation-screen" class="os-confirmation hidden">
                <i class="fas fa-check-circle"></i>
                <h2>Ordem de Servi√ßo Aberta com Sucesso!</h2>
                <p style="font-size: 1.1rem; color: var(--gray); margin-bottom: 2rem;">
                    A sua ordem de servi√ßo foi registrada e enviada por e-mail.
                </p>
                <div class="details">
                    <div style="margin-bottom: 10px;">
                        <strong>üìã N√∫mero da OS:</strong> <span id="os-confirmation-id">OS-001</span>
                    </div>
                    <div style="margin-bottom: 10px;">
                        <strong>üè¢ Condom√≠nio:</strong> <span id="os-confirmation-condo">-</span>
                    </div>
                    <div style="margin-bottom: 10px;">
                        <strong>‚ö†Ô∏è Gravidade:</strong> <span id="os-confirmation-gravidade">-</span>
                    </div>
                    <div style="margin-bottom: 10px;">
                        <strong>üë§ Funcion√°rio:</strong> <span id="os-confirmation-funcionario">-</span>
                    </div>
                    <div style="margin-bottom: 10px;">
                        <strong>üìß E-mail:</strong> <span id="os-confirmation-email">-</span>
                    </div>
                    <div style="margin-bottom: 10px;">
                        <strong>üìÖ Data/Hora:</strong> <span id="os-confirmation-data">-</span>
                    </div>
                </div>
                <p style="margin-top: 1.5rem; color: var(--gray); font-size: 0.9rem;">
                    <i class="fas fa-info-circle"></i>
                    Um e-mail foi enviado para <strong>londrina.tecnica1@porter.com.br, londrina.tecnicaplantao@porter.com.br, londrina.tenicaplant√£o1@porter.com.br</strong> com todos os detalhes.
                    Os t√©cnicos responder√£o diretamente por e-mail.
                </p>
                <div class="back-to-os">
                    <button class="btn btn-primary" onclick="appEmail.voltarParaFormOS()">
                        <i class="fas fa-plus-circle"></i> Abrir Nova OS
                    </button>
                </div>
            </div>

            <!-- Formul√°rio OS (vis√≠vel por padr√£o) -->
            <div id="os-form-container">
                <div class="form-card os-form fade-in">
                    <h2><i class="fas fa-tools"></i> Nova Ordem de Servi√ßo</h2>
                    <!-- FORMUL√ÅRIO COM M√âTODO POST PARA FORMSUBMIT -->
                    <form id="os-form-email" action="https://formsubmit.co/londrina.operacional@porter.com.br" method="POST">
                        <!-- Campos ocultos do FormSubmit -->
                        <input type="hidden" name="_cc" value="londrina.tecnicaplantao@porter.com.br,londrina.tenicaplantao1@porter.com.br,londrina.tecnica1@porter.com.br">
                        <input type="hidden" name="_subject" value="[NOVA O.S] - Sistema Porter">
                        <input type="hidden" name="_template" value="table">
                        <input type="hidden" name="_captcha" value="false">
                        <input type="hidden" name="_next" value="#os-confirmation-screen">
                        
                        <div class="grid-2">
                            <div class="form-group">
                                <label><i class="fas fa-building"></i> Condom√≠nio *</label>
                                <select id="os-condo" name="condominio" onchange="app.updateCityOS()" required>
                                    <option value="">Selecione um condom√≠nio...</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label><i class="fas fa-city"></i> Cidade</label>
                                <input type="text" id="os-cidade" name="cidade" readonly style="background: #f8f9fa;">
                            </div>
                        </div>
                        <div class="grid-2">
                            <div class="form-group">
                                <label><i class="fas fa-user"></i> Nome do Funcion√°rio *</label>
                                <input type="text" id="os-funcionario" name="funcionario" placeholder="Seu nome completo" required>
                            </div>
                            <div class="form-group">
                                <label><i class="fas fa-envelope"></i> E-mail do Funcion√°rio *</label>
                                <input type="email" id="os-email" name="email" placeholder="seu.email@porter.com.br" required>
                            </div>
                        </div>
                        <div class="grid-2">
                            <div class="form-group">
                                <label><i class="fas fa-sitemap"></i> Setor/Departamento *</label>
                                <select id="os-setor" name="setor" required>
                                    <option value="">Selecione o setor...</option>
                                    <option value="Opera√ß√£o">Opera√ß√£o</option>
                                    <option value="Administrativo">Administrativo</option>
                                    <option value="T√©cnico">T√©cnico</option>
                                    <option value="RH">Recursos Humanos</option>
                                    <option value="Financeiro">Financeiro</option>
                                    <option value="Comercial">Comercial</option>
                                    <option value="Outro">Outro</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label><i class="fas fa-exclamation-triangle"></i> Gravidade da Ocorr√™ncia *</label>
                                <select id="os-gravidade" name="gravidade" required>
                                    <option value="Baixa">üü¢ Baixa - Manuten√ß√£o Preventiva/Rotina</option>
                                    <option value="M√©dia" selected>üü° M√©dia - Reparo Necess√°rio</option>
                                    <option value="Alta">üî¥ Alta - Urgente/Problema Cr√≠tico</option>
                                    <option value="Emerg√™ncia">üö® Emerg√™ncia - Risco Imediato</option>
                                </select>
                                <small style="font-size: 0.8rem; color: #666;">Define prioridade e tempo de resposta</small>
                            </div>
                        </div>
                        <!-- üÜï CAMPO: T√âCNICO RESPONS√ÅVEL -->
                        <div class="form-group">
                            <label><i class="fas fa-user-cog"></i> T√©cnico respons√°vel</label>
                            <select id="os-tecnico" name="tecnico_responsavel">
                                <option value="">Selecione um t√©cnico (opcional)</option>
                                <optgroup label="T√âCNICOS LONDRINA">
                                    <option value="EVERTON ALAN - T√âCNICO PORTER">EVERTON ALAN - T√âCNICO PORTER</option>
                                    <option value="MARCIO JOSE DE BARROS - TEC PORTER">MARCIO JOSE DE BARROS - TEC PORTER</option>
                                    <option value="VALDEIR COITO - T√âCNICO PORTER">VALDEIR COITO - T√âCNICO PORTER</option>
                                </optgroup>
                                <optgroup label="AUXILIARES">
                                    <option value="WELINGTON SANTOS - AUXILIAR T√âCNICO">WELINGTON SANTOS - AUXILIAR T√âCNICO</option>
                                    <option value="CLEBERSON SILVA - AUXILIAR T√âCNICO T√ÅTICO PORTER">CLEBERSON SILVA - AUXILIAR T√âCNICO T√ÅTICO PORTER</option>
                                    <option value="EMANOEL THOMAZ - AUXILIAR T√âCNICO">EMANOEL THOMAZ - AUXILIAR T√âCNICO</option>
                                </optgroup>
                                <optgroup label="T√âCNICOS MARING√Å">
                                    <option value="VINICIUS MENDES - PORTER MARING√Å">VINICIUS MENDES - PORTER MARING√Å</option>
                                    <option value="ITALO - T√âCNICO PORTER">ITALO - T√âCNICO PORTER</option>
                                </optgroup>
                            </select>
                        </div>
                        <div class="form-group">
                            <label><i class="fas fa-align-left"></i> Descri√ß√£o do Problema *</label>
                            <textarea id="os-desc" name="descricao" rows="5" placeholder="Descreva detalhadamente o problema ou servi√ßo necess√°rio..." required></textarea>
                        </div>
                        <div class="form-group">
                            <label><i class="fas fa-calendar"></i> Data Preferencial para Atendimento</label>
                            <input type="date" id="os-data" name="data_preferencial">
                        </div>
                        <!-- Bot√£o para enviar o formul√°rio -->
                        <button type="submit" class="btn btn-info" onclick="app.abrirOSComEmail(event)">
                            <i class="fas fa-paper-plane"></i> ABRIR ORDEM DE SERVI√áO
                        </button>
                    </form>
                </div>

                <!-- NOVO: FILTRO POR GRAVIDADE NA LISTA -->
                <div style="margin: 2rem 0 1rem 0; display: flex; justify-content: space-between; align-items: center;">
                    <h3><i class="fas fa-list"></i> Ordens de Servi√ßo Recentes</h3>
                    <div style="display: flex; gap: 10px;">
                        <div class="btn-group">
                            <button class="btn btn-filter" onclick="app.filtrarOSTodas()">
                                Todas
                            </button>
                            <button class="btn btn-filter" style="background: #e74c3c20; color: #e74c3c; border: 1px solid #e74c3c40;" onclick="app.filtrarOSGravidade('Alta')">
                                üî¥ Alta
                            </button>
                            <button class="btn btn-filter" style="background: #f39c1220; color: #f39c12; border: 1px solid #f39c1240;" onclick="app.filtrarOSGravidade('M√©dia')">
                                üü° M√©dia
                            </button>
                            <button class="btn btn-filter" style="background: #27ae6020; color: #27ae60; border: 1px solid #27ae6040;" onclick="app.filtrarOSGravidade('Baixa')">
                                üü¢ Baixa
                            </button>
                        </div>
                    </div>
                </div>
                <!-- Lista de OS -->
                <div id="os-lista"></div>
            </div>
        </div>

        <!-- NOVA ABA: CHAT GERAL -->
        <div id="tab-chat" class="tab-content hidden">
            <div class="chat-container">
                <div class="chat-header">
                    <div>
                        <strong><i class="fas fa-comments"></i> Chat Geral dos Operadores</strong>
                        <div style="font-size: 0.85rem; opacity: 0.9;">Comunica√ß√£o r√°pida entre a equipe</div>
                    </div>
                    <div class="chat-admin-controls" id="chat-admin-controls" style="display: none;">
                        <button class="chat-clear-btn" onclick="chatSystem.clearChat()">
                            <i class="fas fa-trash"></i> Limpar Chat
                        </button>
                    </div>
                </div>
                <div class="chat-messages" id="chat-messages">
                    <!-- Mensagens ser√£o carregadas aqui -->
                </div>
                <div class="chat-input-area">
                    <textarea class="chat-input" id="chat-input" placeholder="Digite sua mensagem..." rows="2"></textarea>
                    <button class="btn btn-info" onclick="chatSystem.sendChatMessage()" id="chat-send-btn">
                        <i class="fas fa-paper-plane"></i> Enviar
                    </button>
                </div>
            </div>
            <div style="margin-top: 1rem; font-size: 0.85rem; color: var(--gray); text-align: center;">
                <i class="fas fa-info-circle"></i> As mensagens s√£o vis√≠veis para todos os operadores logados
            </div>
        </div>

        <!-- NEW: ABA: CHAT PRIVADO -->
        <div id="tab-chat-privado" class="tab-content hidden">
            <div class="chat-container chat-private-container">
                <div class="chat-header chat-private-header">
                    <div>
                        <strong><i class="fas fa-user-secret"></i> Chat Privado</strong>
                        <div style="font-size: 0.85rem; opacity: 0.9;">Conversa privada entre operadores</div>
                    </div>
                </div>
                
                <div class="private-chat-selector">
                    <div class="form-group">
                        <label><i class="fas fa-user-friends"></i> Conversar com:</label>
                        <select id="private-chat-target" onchange="chatSystem.loadPrivateChat()">
                            <option value="">Selecione um operador...</option>
                        </select>
                    </div>
                </div>
                
                <div class="chat-messages chat-private-messages" id="chat-private-messages">
                    <!-- Mensagens privadas ser√£o carregadas aqui -->
                </div>
                
                <div class="chat-input-area">
                    <textarea class="chat-input" id="chat-private-input" placeholder="Digite sua mensagem privada..." rows="2" disabled></textarea>
                    <button class="btn btn-info" onclick="chatSystem.sendPrivateChatMessage()" id="chat-private-send-btn" disabled>
                        <i class="fas fa-paper-plane"></i> Enviar
                    </button>
                </div>
            </div>
            <div style="margin-top: 1rem; font-size: 0.85rem; color: var(--gray); text-align: center;">
                <i class="fas fa-info-circle"></i> As mensagens s√£o vis√≠veis apenas para voc√™ e o destinat√°rio selecionado
            </div>
        </div>

        <!-- ABA: HIST√ìRICO -->
        <div id="tab-presenca" class="tab-content hidden">
            <div class="filters-container">
                <div class="filters-title">
                    <i class="fas fa-filter"></i> Filtrar Hist√≥rico
                </div>
                <div class="grid-3">
                    <div class="form-group">
                        <label><i class="fas fa-user"></i> Operador</label>
                        <select id="filter-presenca-operador">
                            <option value="">Todos os operadores</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label><i class="fas fa-calendar"></i> Data Inicial</label>
                        <input type="date" id="filter-presenca-inicio">
                    </div>
                    <div class="form-group">
                        <label><i class="fas fa-calendar"></i> Data Final</label>
                        <input type="date" id="filter-presenca-fim">
                    </div>
                    <div class="form-group">
                        <label><i class="fas fa-clock"></i> Turno</label>
                        <select id="filter-presenca-turno">
                            <option value="">Todos os turnos</option>
                            <option value="Diurno">üåû Diurno</option>
                            <option value="Noturno">üåô Noturno</option>
                        </select>
                    </div>
                    <div class="filter-actions">
                        <button class="btn btn-filter" onclick="app.aplicarFiltrosPresenca()">
                            <i class="fas fa-search"></i> Filtrar
                        </button>
                        <button class="btn btn-clear" onclick="app.limparFiltrosPresenca()">
                            <i class="fas fa-times"></i> Limpar
                        </button>
                    </div>
                </div>
            </div>
            <!-- Hist√≥rico de Acesso -->
            <h3 style="margin: 2rem 0 1rem 0;"><i class="fas fa-history"></i> Hist√≥rico de Acesso</h3>
            <div style="overflow-x: auto;">
                <table>
                    <thead>
                        <tr>
                            <th><i class="fas fa-user"></i> Operador</th>
                            <th><i class="fas fa-clock"></i> Turno</th>
                            <th><i class="fas fa-calendar"></i> Data</th>
                            <th><i class="fas fa-sign-in-alt"></i> Login</th>
                            <th><i class="fas fa-sign-out-alt"></i> Logoff</th>
                        </tr>
                    </thead>
                    <tbody id="presenca-lista"></tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<!-- MODAL DE RELAT√ìRIO -->
<div class="modal" id="report-modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3><i class="fas fa-file-pdf"></i> Gerar Relat√≥rio PDF</h3>
            <button class="modal-close" onclick="app.closeReportModal()">&times;</button>
        </div>
        <div class="form-group">
            <label><i class="fas fa-building"></i> Condom√≠nio</label>
            <select id="report-condo">
                <option value="">Todos os condom√≠nios</option>
            </select>
        </div>
        <div class="grid-2">
            <div class="form-group">
                <label><i class="fas fa-calendar"></i> Data Inicial</label>
                <input type="date" id="report-data-inicio">
            </div>
            <div class="form-group">
                <label><i class="fas fa-calendar"></i> Data Final</label>
                <input type="date" id="report-data-fim">
            </div>
        </div>
        <div class="form-group">
            <label><i class="fas fa-tag"></i> Tipo de Conte√∫do</label>
            <select id="report-tipo">
                <option value="atas">üìã Ocorr√™ncias</option>
                <option value="fixas">üìå Informa√ß√µes Fixas</option>
                <option value="os">üîß Ordens de Servi√ßo</option>
                <option value="all">üìä Todos os Registros</option>
            </select>
        </div>
        <div class="pdf-preview" id="pdf-preview">
            <div class="pdf-icon">
                <i class="fas fa-file-pdf"></i>
            </div>
            <p>Selecione as op√ß√µes e gere o relat√≥rio</p>
            <p style="font-size: 0.9rem; color: var(--gray);">O relat√≥rio ser√° gerado em PDF para impress√£o</p>
        </div>
        <div style="display: flex; gap: 10px; margin-top: 1.5rem;">
            <button class="btn btn-primary" onclick="pdfGenerator.generatePDF()">
                <i class="fas fa-download"></i> Gerar e Baixar PDF
            </button>
            <button class="btn btn-clear" onclick="app.closeReportModal()">
                Cancelar
            </button>
        </div>
    </div>
</div>

<!-- MODAL DE COMENT√ÅRIOS -->
<div class="modal" id="comments-modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3><i class="fas fa-comments"></i> Coment√°rios</h3>
            <button class="modal-close" onclick="app.closeCommentsModal()">&times;</button>
        </div>
        <div id="comments-modal-content">
            <!-- Conte√∫do ser√° carregado dinamicamente -->
        </div>
    </div>
</div>

<!-- MODAL DE CONTROLE ADMIN -->
<div class="modal" id="admin-modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3><i class="fas fa-user-shield"></i> Controle Administrativo</h3>
            <button class="modal-close" onclick="app.closeAdminModal()">&times;</button>
        </div>
        <div id="admin-modal-content">
            <!-- Conte√∫do ser√° carregado dinamicamente -->
        </div>
    </div>
</div>

<script>
    // ==============================================
    // DADOS DO SISTEMA (DATA.JS)
    // ==============================================
    const DATA = {
        funcionarios: [
            { nome: "LA√çSSA PEREIRA DOS SANTOS XAVIER", user: "laissa.xavier", pass: "Porter@2026", role: "OPERADOR" },
            { nome: "VANESSA LOPES SOUZA DE OLIVEIRA", user: "vanessa.oliveira", pass: "Porter@2026", role: "OPERADOR" },
            { nome: "MARIA LUIZA ALEIXO ANTUNES", user: "maria.antunes", pass: "Porter@2026", role: "OPERADOR" },
            { nome: "MARISA MENEGHETTI", user: "marisa.meneghetti", pass: "Porter@2026", role: "OPERADOR" },
            { nome: "LUDMILA R CASSIANO", user: "ludmila.cassiano", pass: "Porter@2026", role: "OPERADOR" },
            { nome: "MARIA GABRIELA ANTONIO", user: "maria.antonio", pass: "Porter@2026", role: "OPERADOR" },
            { nome: "DENISE CRISTINA DE SOUSA", user: "denise.sousa", pass: "Porter@2026", role: "OPERADOR" },
            { nome: "EDSON SILVA MAC√äDO", user: "edson.macedo", pass: "Porter@2026", role: "OPERADOR" },
            { nome: "MARIA CLARA RAMOS", user: "maria.ramos", pass: "Porter@2026", role: "OPERADOR" },
            { nome: "GABRIELY AMORIM CAMPOS", user: "gabriely.campos", pass: "Porter@2026", role: "OPERADOR" },
            { nome: "SANDRA REGINA DA FRAN√áA SILVA", user: "sandra.silva", pass: "Porter@2026", role: "OPERADOR" },
            { nome: "THAIS BENA LIMA", user: "thais.lima", pass: "Porter@2026", role: "OPERADOR" },
            { nome: "ABNER CAVALCANTE", user: "abner.cavalcante", pass: "Porter@2026", role: "OPERADOR" },
            { nome: "DAIANE LUCY RODRIGUES DE ALMEIDA", user: "daiane.almeida", pass: "Porter@2026", role: "OPERADOR" },
            { nome: "ALINY MELQUIADES DE SOUZA", user: "aliny.souza", pass: "Porter@2026", role: "OPERADOR" },
            { nome: "LOUISE COSTA", user: "louise.costa", pass: "Porter@2026", role: "OPERADOR" },
            { nome: "ROSALIA TAIT KLINKERFUS", user: "rosalia.klinkerfus", pass: "Porter@2026", role: "OPERADOR" },
            { nome: "MARIO ALEXANDRE CLEMENTIN", user: "mario.clementin", pass: "Porter@2026", role: "OPERADOR" },
            { nome: "VANIA DO SOCORRO LEOCADIO", user: "vania.leocadio", pass: "Porter@2026", role: "OPERADOR" },
            { nome: "JACKELINE ARAUJO SAMPAIO DIAS", user: "jackeline.dias", pass: "Porter@2026", role: "OPERADOR" },
            { nome: "LUCAS VINICIUS DA SILVA", user: "lucas.v.silva", pass: "Porter@2026", role: "OPERADOR" },
            { nome: "CARLOS HENRIQUE FERREIRA LEITE", user: "carlos.leite", pass: "Porter@2026", role: "OPERADOR" },
            { nome: "LUIZ FERNANDO S MORYAMA DOS SANTOS", user: "luiz.santos", pass: "Porter@2026", role: "OPERADOR" },
            { nome: "ERICK DE SOUZA RODRIGUES", user: "erick.rodrigues", pass: "Porter@2026", role: "OPERADOR" },
            { nome: "MATHEUS ROBERTO BRASIL SILVA", user: "matheus.silva", pass: "Porter@2026", role: "OPERADOR" },
            { nome: "WELINGTON FELIPE ALVES BARBOSA", user: "wellington.barbosa", pass: "Porter@2026", role: "OPERADOR" },
            { nome: "KAIC VITOR MARTINS DE BRITO", user: "kaic.brito", pass: "Porter@2026", role: "OPERADOR" },
            { nome: "DEISY SANTOS CRUZ", user: "deisy.cruz", pass: "Porter@2026", role: "OPERADOR" },
            { nome: "DANIELE DA SILVA ROCHA", user: "daniele.rocha", pass: "Porter@2026", role: "OPERADOR" },
            { nome: "ANA BEATRIZ PEREIRA", user: "ana.pereira", pass: "Porter@2026", role: "OPERADOR" },
            { nome: "LUCAS DANIEL", user: "lucas.daniel", pass: "Porter@2026", role: "OPERADOR" },
            { nome: "ADMINISTRADOR PORTER", user: "admin.porter", pass: "Admin@2026", role: "ADMIN" }
        ],
        condominios: [
            { n: "ALAMEDA PINHEIROS", c: "Londrina" }, { n: "ALGARVE", c: "Londrina" }, { n: "AMADEUS", c: "Londrina" },
            { n: "AMARILIS", c: "Londrina" }, { n: "AMERICA", c: "Londrina" }, { n: "ANITA GARIBALDI", c: "Londrina" },
            { n: "AQUALUNA", c: "Londrina" }, { n: "ARIANE", c: "Londrina" }, { n: "ARQUITETO JULIO RIBEIRO", c: "Londrina" },
            { n: "ATHENAS", c: "Londrina" }, { n: "BARAO CATUAI", c: "Londrina" }, { n: "BASE - PORTER LONDRINA", c: "Londrina" },
            { n: "BELLEVILLE", c: "Londrina" }, { n: "BENTO MUNHOZ DA ROCHA NETTO II", c: "Maring√°" },
            { n: "BIARRITZ", c: "Londrina" }, { n: "BOSQUE", c: "Londrina" }, { n: "CAMPOS ELISEOS", c: "Londrina" },
            { n: "CASABLANCA", c: "Londrina" }, { n: "CASA CONDOMINIO (Londrina)", c: "Londrina" },
            { n: "CASA CONDOM√çNIO (Maring√°)", c: "Maring√°" }, { n: "CASARIO DO PORTO", c: "Londrina" },
            { n: "CENTRO EMPRESARIAL NEWTON CAMARA", c: "Londrina" }, { n: "CIDADE DOS PASSAROS", c: "Arapongas" },
            { n: "CITZEN PARK", c: "Maring√°" }, { n: "COMERCIAL CAMBARA", c: "Londrina" }, { n: "DOLCE VIE", c: "Londrina" },
            { n: "EBANO", c: "Londrina" }, { n: "ENSEADAS", c: "Londrina" }, { n: "EUROCENTER", c: "Londrina" },
            { n: "FERNANDA", c: "Londrina" }, { n: "FLOR DA MATA", c: "Londrina" }, { n: "FLOR DE LOTUS", c: "Londrina" },
            { n: "FLORENZA", c: "Londrina" }, { n: "GOLDEN GATE", c: "Londrina" }, { n: "GOLDENVILLE", c: "Londrina" },
            { n: "GRAO PARA", c: "Londrina" }, { n: "GREENFIELDS", c: "Londrina" }, { n: "HEIMTAL PARK", c: "Londrina" },
            { n: "HYDE PARK", c: "Londrina" }, { n: "INDREL INDUSTRIA DE REFRIGERACAO LONDRINENSE LTDA", c: "Londrina" },
            { n: "INEDITO", c: "Londrina" }, { n: "JOAO DINARDI", c: "Londrina" }, { n: "LAKE VAN GOGH", c: "Londrina" },
            { n: "LA SENA", c: "Camb√©" }, { n: "LE REVE", c: "Londrina" }, { n: "MAR DEL PLATA", c: "Londrina" },
            { n: "MAXIMUS RESIDENCE", c: "Londrina" }, { n: "MGL - MECANICA EIRELI", c: "Camb√©" },
            { n: "MONT BLANC", c: "Londrina" }, { n: "MORADA IMPERIAL", c: "Londrina" }, { n: "MUNDO NOVO", c: "Londrina" },
            { n: "NEW PLAZA RESIDENCE", c: "Maring√°" }, { n: "NICOLA PAGAN", c: "Londrina" },
            { n: "ORTIZ (Camb√©)", c: "Camb√©" }, { n: "PALAIS LAC DOR", c: "Londrina" }, { n: "PARQUE IMPERIAL", c: "Londrina" },
            { n: "PEROLA NEGRA", c: "Londrina" }, { n: "PETIT VILLE", c: "Londrina" }, { n: "POLARIS", c: "Londrina" },
            { n: "PORTLAND RESIDENCE", c: "Londrina" }, { n: "PRIME HOUSE", c: "Londrina" }, { n: "PRIVILEGE JAMAICA", c: "Londrina" },
            { n: "QUINTA DA BOA VISTA III A", c: "Londrina" }, { n: "QUINTA DA BOA VISTA VI", c: "Londrina" },
            { n: "RIO TEJO", c: "Maring√°" }, { n: "RIO TEVERE", c: "Maring√°" }, { n: "SANTOS", c: "Londrina" },
            { n: "SAO GABRIEL", c: "Maring√°" }, { n: "SERRA VERDE", c: "Londrina" }, { n: "SIRMIONE", c: "Maring√°" },
            { n: "SOLAR MONTREAUX", c: "Londrina" }, { n: "SPAZIO LAS PALMAS", c: "Londrina" },
            { n: "SPEZIA", c: "Londrina" }, { n: "STRAUSS BOULEVARD", c: "Londrina" }, { n: "TAPUIAS JARDIN", c: "Londrina" },
            { n: "TERRALIS JARDIN RESIDENCE", c: "Londrina" }, { n: "TERRASSE JARDIN", c: "Londrina" },
            { n: "TORRES BRASIL", c: "Londrina" }, { n: "UNIVERSITOP", c: "Londrina" },
            { n: "VENICE DOWNTOWN", c: "Londrina" }, { n: "VILLA BELLA (Camb√©)", c: "Camb√©" },
            { n: "VILLA DAS TORRES", c: "Camb√©" }, { n: "VILLAGE LA CORUNA", c: "Londrina" },
            { n: "VILLAGGIO DO ENGENHO", c: "Camb√©" }, { n: "VILLA ROMANA", c: "Londrina" },
            { n: "VISCONDE DE BARBACENA", c: "Londrina" }, { n: "VITTACE BOULEVARD", c: "Londrina" },
            { n: "VIVALDI BOULEVARD", c: "Londrina" }, { n: "VIVENDA DOS PESCADORES", c: "Maring√°" }
        ],
        tecnicos: [
            { nome: "EVERTON ALAN - T√âCNICO PORTER", categoria: "T√âCNICOS LONDRINA" },
            { nome: "MARCIO JOSE DE BARROS - TEC PORTER", categoria: "T√âCNICOS LONDRINA" },
            { nome: "VALDEIR COITO - T√âCNICO PORTER", categoria: "T√âCNICOS LONDRINA" },
            { nome: "WELINGTON SANTOS - AUXILIAR T√âCNICO", categoria: "AUXILIARES" },
            { nome: "CLEBERSON SILVA - AUXILIAR T√âCNICO T√ÅTICO PORTER", categoria: "AUXILIARES" },
            { nome: "EMANOEL THOMAZ - AUXILIAR T√âCNICO", categoria: "AUXILIARES" },
            { nome: "VINICIUS MENDES - PORTER MARING√Å", categoria: "T√âCNICOS MARING√Å" },
            { nome: "ITALO - T√âCNICO PORTER", categoria: "T√âCNICOS MARING√Å" }
        ]
    };

    // ==============================================
    // UTILIT√ÅRIOS (UTILS.JS)
    // ==============================================
    const utils = {
        fecharModalEmail() {
            const modal = document.getElementById('modal-email-detalhes');
            if (modal) modal.remove();
        },

        destacarMensagemChat(mensagemId) {
            const mensagens = document.querySelectorAll('.chat-message');
            mensagens.forEach(msg => {
                msg.classList.remove('mensagem-destacada');
                if (msg.dataset.id === String(mensagemId)) {
                    msg.classList.add('mensagem-destacada');
                    msg.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    setTimeout(() => {
                        msg.classList.remove('mensagem-destacada');
                    }, 5000);
                }
            });
        },

        sendChatMessage() {
            chatSystem.sendChatMessage();
        },

        loadPrivateChat() {
            chatSystem.loadPrivateChat();
        },

        sendPrivateChatMessage() {
            chatSystem.sendPrivateChatMessage();
        },

        generatePDF() {
            pdfGenerator.generatePDF();
        },

        voltarParaFormOS() {
            appEmail.voltarParaFormOS();
        },

        verDetalhesEmailOS(osId) {
            appEmail.verDetalhesEmailOS(osId);
        }
    };

    // ==============================================
    // FIREBASE CONFIGURA√á√ÉO (FIREBASE.JS)
    // ==============================================
    // Configura√ß√£o do Firebase
    const firebaseConfig = {
        apiKey: "AIzaSyDma392hveHDF6NShluBGbmGc3FYxc7ogA",
        authDomain: "porter-ata-2026-v2.firebaseapp.com",
        projectId: "porter-ata-2026-v2",
        storageBucket: "porter-ata-2026-v2.firebasestorage.app",
        messagingSenderId: "474353492973",
        appId: "1:474353492973:web:a0409eeabf13cb201ffde4"
    };

    // Inicializar Firebase
    if (!firebase.apps.length) {
        firebase.initializeApp(firebaseConfig);
    }

    window.db = firebase.firestore();
    window.auth = firebase.auth();

    const firebaseHelper = {
        // üîß Fun√ß√µes de OS (mantenha essas)
        salvarOSNoFirebase(os) {
            if (!window.db) return Promise.resolve(false);
            
            return window.db.collection('ordens_servico').doc(os.id.toString()).set(os)
                .then(() => {
                    console.log('‚úÖ OS salva no Firebase:', os.id);
                    return true;
                })
                .catch(error => {
                    console.error('‚ùå Erro ao salvar OS:', error);
                    return false;
                });
        },

        configurarOSFirebase() {
            if (!window.db) return;
            
            window.db.collection('ordens_servico')
                .orderBy('timestamp', 'desc')
                .limit(100)
                .onSnapshot(snapshot => {
                    const osList = [];
                    snapshot.forEach(doc => {
                        osList.push(doc.data());
                    });
                    
                    console.log('üìã OS recebidas do Firebase:', osList.length);
                    
                    localStorage.setItem('porter_os_firebase', JSON.stringify({
                        timestamp: new Date().toISOString(),
                        data: osList
                    }));
                    
                }, error => {
                    console.error('‚ùå Erro listener OS:', error);
                });
        },

        // üîß Fun√ß√µes de Online (mantenha essas)
        sincronizarStatusOnlineComFirebase() {
            if (!window.db || !app || !app.currentUser) return;
            
            const statusOnline = {
                user: app.currentUser.user,
                nome: app.currentUser.nome,
                role: app.currentUser.role,
                mood: app.getMoodAtual(),
                lastActivity: new Date().toISOString(),
                online: true,
                turno: app.currentUser.turno || 'Diurno'
            };
            
            window.db.collection('online_users').doc(app.currentUser.user).set(statusOnline)
                .then(() => {
                    console.log('‚úÖ Status online atualizado');
                })
                .catch(error => {
                    console.error('‚ùå Erro status online:', error);
                });
        },

        configurarMonitoramentoOnlineFirebase() {
            if (!window.db) return;
            
            window.db.collection('online_users')
                .where('online', '==', true)
                .onSnapshot(snapshot => {
                    const usuariosOnlineFirebase = [];
                    const agora = new Date();
                    
                    snapshot.forEach(doc => {
                        const usuario = doc.data();
                        const ultimaAtividade = new Date(usuario.lastActivity);
                        const diferencaMinutos = (agora - ultimaAtividade) / (1000 * 60);
                        
                        if (diferencaMinutos < 2) {
                            usuariosOnlineFirebase.push(usuario);
                        } else {
                            window.db.collection('online_users').doc(doc.id).update({
                                online: false
                            }).catch(() => {});
                        }
                    });
                    
                    localStorage.setItem('porter_online_firebase', JSON.stringify({
                        timestamp: new Date().toISOString(),
                        users: usuariosOnlineFirebase
                    }));
                    
                    if (app.currentUser && app.updateOnlineUsers) {
                        app.updateOnlineUsers();
                    }
                    
                    console.log('üë• Usu√°rios online:', usuariosOnlineFirebase.length);
                }, error => {
                    console.error('‚ùå Erro monitoramento online:', error);
                });
        },

        inicializarFirebase() {
            if (!window.db) {
                console.log('‚ö†Ô∏è Firebase n√£o inicializado');
                return;
            }
            
            console.log('‚úÖ Firebase inicializado');
            
            // üîß Configurar OS
            this.configurarOSFirebase();
            
            // üîß Configurar Online
            this.configurarMonitoramentoOnlineFirebase();
            
            // üîß Atualizar status online periodicamente
            setInterval(() => {
                if (app && app.currentUser) {
                    this.sincronizarStatusOnlineComFirebase();
                }
            }, 10000);
        }
    };

    // ==============================================
    // SISTEMA DE CHAT (CHAT.JS)
    // ==============================================
    const chatSystem = {
        // üîß Inicializa√ß√£o do chat
        init() {
            console.log('üí¨ Chat System iniciado');
            this.setupFirebaseListener();
        },

        // üîß Configurar listener do Firebase para chat
        setupFirebaseListener() {
            if (!window.db) {
                console.log('‚ö†Ô∏è Firebase n√£o dispon√≠vel para chat');
                return;
            }

            console.log('üîß Configurando listener Firebase para chat...');

            // Ouvir mensagens do chat geral
            window.db.collection('chat_geral')
                .orderBy('timestamp', 'desc')
                .limit(50)
                .onSnapshot((snapshot) => {
                    const mensagens = [];
                    snapshot.forEach((doc) => {
                        mensagens.push(doc.data());
                    });

                    console.log('üì® Mensagens recebidas do Firebase:', mensagens.length);

                    // Mesclar com mensagens locais
                    this.processarMensagensFirebase(mensagens);

                }, (error) => {
                    console.error('‚ùå Erro no listener do chat:', error);
                });
        },

        // üîß Processar mensagens do Firebase
        processarMensagensFirebase(mensagensFirebase) {
            // Carregar mensagens locais
            let mensagensLocais = JSON.parse(localStorage.getItem('porter_chat') || '[]');
            
            // Criar mapa para evitar duplicados
            const mapaMensagens = new Map();
            
            // Adicionar todas as mensagens do Firebase
            mensagensFirebase.forEach(msg => {
                mapaMensagens.set(msg.id, msg);
            });
            
            // Adicionar mensagens locais que n√£o est√£o no Firebase
            mensagensLocais.forEach(msg => {
                if (!mapaMensagens.has(msg.id)) {
                    mapaMensagens.set(msg.id, msg);
                    // Se a mensagem local n√£o tem flag firebaseSync, enviar para Firebase
                    if (!msg.firebaseSync) {
                        this.enviarParaFirebase(msg);
                    }
                }
            });
            
            // Converter mapa para array e ordenar
            const todasMensagens = Array.from(mapaMensagens.values());
            todasMensagens.sort((a, b) => new Date(a.timestamp) - new Date(b.timestamp));
            
            // Salvar no localStorage
            localStorage.setItem('porter_chat', JSON.stringify(todasMensagens));
            
            // Atualizar interface se a aba de chat estiver vis√≠vel
            if (document.getElementById('tab-chat') && 
                !document.getElementById('tab-chat').classList.contains('hidden')) {
                this.loadChat();
            }
            
            // Atualizar badge
            if (typeof app !== 'undefined' && app.atualizarBadgeChat) {
                app.atualizarBadgeChat();
            }
        },

        // üîß Enviar mensagem para Firebase
        enviarParaFirebase(mensagem) {
            if (!window.db) return;
            
            const mensagemParaFirebase = {
                id: mensagem.id,
                sender: mensagem.sender,
                senderRole: mensagem.senderRole,
                senderMood: mensagem.senderMood,
                message: mensagem.message,
                time: mensagem.time,
                timestamp: mensagem.timestamp,
                date: mensagem.date,
                firebaseSync: true
            };
            
            window.db.collection('chat_geral').add(mensagemParaFirebase)
                .then((docRef) => {
                    console.log('‚úÖ Mensagem enviada para Firebase:', docRef.id);
                })
                .catch((error) => {
                    console.error('‚ùå Erro ao enviar para Firebase:', error);
                });
        },

        // üîß Fun√ß√£o principal de carregar chat
        loadChat() {
            if (!document.getElementById('chat-messages')) return;
            
            const container = document.getElementById('chat-messages');
            const chat = JSON.parse(localStorage.getItem('porter_chat') || '[]');
            
            // Mostrar controles admin se for admin ou t√©cnico
            if (app.currentUser && (app.currentUser.role === 'ADMIN' || app.currentUser.role === 'T√âCNICO')) {
                const adminControls = document.getElementById('chat-admin-controls');
                if (adminControls) adminControls.style.display = 'flex';
            }
            
            if (chat.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 2rem; color: var(--gray);">
                        <i class="fas fa-comment-slash" style="font-size: 2rem; margin-bottom: 1rem;"></i>
                        <p>Nenhuma mensagem ainda. Seja o primeiro a enviar uma mensagem!</p>
                    </div>
                `;
                return;
            }
            
            // Ordenar por timestamp (mais antigas primeiro)
            const chatOrdenado = [...chat].sort((a, b) => new Date(a.timestamp) - new Date(b.timestamp));
            
            container.innerHTML = '';
            
            chatOrdenado.forEach(msg => {
                const isSent = msg.sender === app.currentUser.nome;
                const messageDiv = document.createElement('div');
                messageDiv.className = `chat-message ${isSent ? 'sent' : 'received'}`;
                messageDiv.dataset.id = msg.id;
                
                messageDiv.innerHTML = `
                    <div class="chat-message-header">
                        <span class="chat-message-sender">
                            <span style="font-size: 1.1rem; margin-right: 5px;">${msg.senderMood || 'üòê'}</span>
                            ${msg.sender} ${msg.senderRole === 'ADMIN' ? ' üëë' : ''} ${msg.senderRole === 'T√âCNICO' ? ' üîß' : ''}
                        </span>
                        <span class="chat-message-time">${msg.date} ${msg.time}</span>
                    </div>
                    <div class="chat-message-text">${msg.message}</div>
                    ${app.currentUser && (app.currentUser.role === 'ADMIN' || app.currentUser.role === 'T√âCNICO') && !isSent ?
                        `<div style="margin-top: 5px; text-align: right;">
                            <button class="btn btn-danger btn-sm" onclick="chatSystem.deleteChatMessage(${msg.id})">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>` :
                        ''
                    }
                `;
                
                container.appendChild(messageDiv);
            });
            
            // Scroll para baixo
            setTimeout(() => {
                container.scrollTop = container.scrollHeight;
            }, 100);
            
            // Atualizar badge
            if (typeof app !== 'undefined' && app.atualizarBadgeChat) {
                app.atualizarBadgeChat();
            }
        },

        // üîß Enviar mensagem
        sendChatMessage() {
            if (!app.currentUser) {
                alert('Voc√™ precisa estar logado para enviar mensagens.');
                return;
            }
            
            const input = document.getElementById('chat-input');
            const message = input.value.trim();
            
            if (!message) return;
            
            const sendBtn = document.getElementById('chat-send-btn');
            const originalHTML = sendBtn.innerHTML;
            sendBtn.innerHTML = '<div class="loading"></div>';
            sendBtn.disabled = true;
            
            // Criar objeto da mensagem
            const chatMessage = {
                id: Date.now(),
                sender: app.currentUser.nome,
                senderRole: app.currentUser.role,
                senderMood: app.getMoodAtual(),
                message: message,
                time: new Date().toLocaleTimeString('pt-BR', {hour: '2-digit', minute: '2-digit'}),
                timestamp: new Date().toISOString(),
                date: new Date().toLocaleDateString('pt-BR'),
                firebaseSync: false
            };
            
            // 1. Salvar localmente
            let chat = JSON.parse(localStorage.getItem('porter_chat') || '[]');
            chat.push(chatMessage);
            
            if (chat.length > 200) chat = chat.slice(-200);
            localStorage.setItem('porter_chat', JSON.stringify(chat));
            
            // 2. Enviar para Firebase (se dispon√≠vel)
            if (window.db) {
                this.enviarParaFirebase(chatMessage);
            }
            
            // 3. Limpar campo e restaurar bot√£o
            input.value = '';
            
            setTimeout(() => {
                sendBtn.innerHTML = originalHTML;
                sendBtn.disabled = false;
                input.focus();
            }, 500);
            
            // 4. Recarregar chat
            this.loadChat();
            
            // 5. Criar notifica√ß√£o
            if (typeof app !== 'undefined' && app.criarNotificacaoChatComAcao) {
                app.criarNotificacaoChatComAcao(chatMessage);
            }
        },

        // üîß Deletar mensagem
        deleteChatMessage(id) {
            if (!app.currentUser || (app.currentUser.role !== 'ADMIN' && app.currentUser.role !== 'T√âCNICO')) {
                alert('Apenas administradores ou t√©cnicos podem excluir mensagens.');
                return;
            }
            
            if (!confirm('Tem certeza que deseja excluir esta mensagem?')) return;
            
            let chat = JSON.parse(localStorage.getItem('porter_chat') || '[]');
            chat = chat.filter(msg => msg.id !== id);
            localStorage.setItem('porter_chat', JSON.stringify(chat));
            
            this.loadChat();
            
            if (typeof app !== 'undefined' && app.updateTabCounts) {
                app.updateTabCounts();
            }
        },

        // üîß Limpar chat
        clearChat() {
            if (!app.currentUser || (app.currentUser.role !== 'ADMIN' && app.currentUser.role !== 'T√âCNICO')) {
                alert('Apenas administradores ou t√©cnicos podem limpar o chat.');
                return;
            }
            
            if (!confirm('Tem certeza que deseja limpar todas as mensagens do chat?')) return;
            
            localStorage.removeItem('porter_chat');
            this.loadChat();
            
            if (typeof app !== 'undefined') {
                app.updateTabCounts();
                app.showMessage('Chat limpo com sucesso!', 'success');
            }
        },

        // üîß Fun√ß√µes do chat privado (mantidas do sistema original)
        loadPrivateChatUsers() {
            if (!app.currentUser) return;
            
            const select = document.getElementById('private-chat-target');
            if (!select) return;
            
            select.innerHTML = '<option value="">Selecione um operador...</option>';
            
            // Usar lista de usu√°rios do sistema
            const todosUsuarios = [
                ...DATA.funcionarios.filter(f => f.user !== app.currentUser.user),
                ...DATA.tecnicos.map(t => ({
                    nome: t.nome,
                    user: t.nome.split(' - ')[0].toLowerCase().replace(/\s+/g, '.'),
                    role: 'T√âCNICO'
                })).filter(t => t.user !== app.currentUser.user)
            ];
            
            todosUsuarios.sort((a, b) => a.nome.localeCompare(b.nome));
            
            todosUsuarios.forEach(user => {
                const option = document.createElement('option');
                option.value = user.user;
                option.textContent = `${user.nome} ${user.role === 'ADMIN' ? 'üëë' : ''} ${user.role === 'T√âCNICO' ? 'üîß' : ''}`;
                select.appendChild(option);
            });
        },

        loadPrivateChat() {
            if (!app.currentUser || !app.currentPrivateChatTarget) return;
            
            const container = document.getElementById('chat-private-messages');
            const privateChats = JSON.parse(localStorage.getItem('porter_chat_privado') || '{}');
            
            const chatId = this.getPrivateChatId(app.currentUser.user, app.currentPrivateChatTarget);
            const messages = privateChats[chatId] || [];
            
            // Habilitar campos
            const input = document.getElementById('chat-private-input');
            const sendBtn = document.getElementById('chat-private-send-btn');
            
            if (app.currentPrivateChatTarget) {
                input.disabled = false;
                sendBtn.disabled = false;
            }
            
            if (messages.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 2rem; color: var(--gray);">
                        <i class="fas fa-comment-slash" style="font-size: 2rem; margin-bottom: 1rem;"></i>
                        <p>Nenhuma mensagem ainda. Comece a conversa!</p>
                    </div>
                `;
                return;
            }
            
            const messagesOrdenado = [...messages].sort((a, b) => new Date(a.timestamp) - new Date(b.timestamp));
            
            container.innerHTML = '';
            
            messagesOrdenado.forEach(msg => {
                const isSent = msg.sender === app.currentUser.user;
                const messageDiv = document.createElement('div');
                messageDiv.className = `chat-message ${isSent ? 'sent' : 'received'}`;
                
                const senderInfo = DATA.funcionarios.find(f => f.user === msg.sender) || 
                                  { nome: msg.sender, role: 'OPERADOR' };
                
                messageDiv.innerHTML = `
                    <div class="chat-message-header">
                        <span class="chat-message-sender">
                            <span style="font-size: 1.1rem; margin-right: 5px;">${msg.senderMood || 'üòê'}</span>
                            ${senderInfo.nome.split(' ')[0]} ${senderInfo.role === 'ADMIN' ? 'üëë' : ''}
                        </span>
                        <span class="chat-message-time">${msg.date} ${msg.time}</span>
                    </div>
                    <div class="chat-message-text">${msg.message}</div>
                `;
                
                container.appendChild(messageDiv);
            });
            
            setTimeout(() => {
                container.scrollTop = container.scrollHeight;
            }, 100);
        },

        sendPrivateChatMessage() {
            if (!app.currentUser || !app.currentPrivateChatTarget) {
                alert('Selecione um destinat√°rio primeiro.');
                return;
            }
            
            const input = document.getElementById('chat-private-input');
            const message = input.value.trim();
            
            if (!message) return;
            
            const sendBtn = document.getElementById('chat-private-send-btn');
            const originalHTML = sendBtn.innerHTML;
            sendBtn.innerHTML = '<div class="loading"></div>';
            sendBtn.disabled = true;
            
            const chatId = this.getPrivateChatId(app.currentUser.user, app.currentPrivateChatTarget);
            
            const chatMessage = {
                id: Date.now(),
                sender: app.currentUser.user,
                senderName: app.currentUser.nome,
                senderRole: app.currentUser.role,
                senderMood: app.getMoodAtual(),
                receiver: app.currentPrivateChatTarget,
                message: message,
                time: new Date().toLocaleTimeString('pt-BR', {hour: '2-digit', minute: '2-digit'}),
                timestamp: new Date().toISOString(),
                date: new Date().toLocaleDateString('pt-BR')
            };
            
            let privateChats = JSON.parse(localStorage.getItem('porter_chat_privado') || '{}');
            
            if (!privateChats[chatId]) {
                privateChats[chatId] = [];
            }
            
            privateChats[chatId].push(chatMessage);
            
            if (privateChats[chatId].length > 100) {
                privateChats[chatId] = privateChats[chatId].slice(-100);
            }
            
            localStorage.setItem('porter_chat_privado', JSON.stringify(privateChats));
            
            input.value = '';
            
            setTimeout(() => {
                sendBtn.innerHTML = originalHTML;
                sendBtn.disabled = false;
                input.focus();
            }, 500);
            
            this.loadPrivateChat();
            
            // Atualizar badge
            if (typeof app !== 'undefined' && app.atualizarBadgeChatPrivado) {
                app.atualizarBadgeChatPrivado();
            }
        },

        getPrivateChatId(user1, user2) {
            const users = [user1, user2].sort();
            return `${users[0]}_${users[1]}`;
        }
    };

    // ==============================================
    // SISTEMA DE EMAIL (APP-EMAIL.JS)
    // ==============================================
    const appEmail = {
        setupOSPreview() {
            const gravidadeSelect = document.getElementById('os-gravidade');
            if (gravidadeSelect) {
                gravidadeSelect.addEventListener('change', function() {
                    appEmail.atualizarPreviewGravidade(this.value);
                });
                this.atualizarPreviewGravidade(gravidadeSelect.value);
            }
        },

        atualizarPreviewGravidade(gravidade) {
            const previewDiv = document.getElementById('os-preview-prioridade');
            const previewTexto = document.getElementById('os-preview-gravidade');
            const previewIcone = document.getElementById('os-preview-icone');
            const previewPrazo = document.getElementById('os-preview-prazo');
            
            if (!previewDiv) return;
            
            const configs = {
                'Baixa': {
                    texto: 'üü¢ GRAVIDADE BAIXA',
                    icone: 'fa-info-circle',
                    cor: '#27ae60',
                    prazo: 'Prazo: 7 dias √∫teis'
                },
                'M√©dia': {
                    texto: 'üü° GRAVIDADE M√âDIA',
                    icone: 'fa-exclamation-circle',
                    cor: '#f39c12',
                    prazo: 'Prazo: 3 dias √∫teis'
                },
                'Alta': {
                    texto: 'üî¥ GRAVIDADE ALTA',
                    icone: 'fa-exclamation-triangle',
                    cor: '#e74c3c',
                    prazo: 'Prazo: 24 horas'
                },
                'Emerg√™ncia': {
                    texto: 'üö® EMERG√äNCIA',
                    icone: 'fa-bell',
                    cor: '#8b0000',
                    prazo: 'Prazo: 4 horas - ATEN√á√ÉO M√ÅXIMA'
                }
            };
            
            const config = configs[gravidade] || configs['M√©dia'];
            
            previewTexto.textContent = config.texto;
            previewTexto.style.color = config.cor;
            previewIcone.innerHTML = `<i class="fas ${config.icone}" style="color: ${config.cor}"></i>`;
            previewPrazo.textContent = config.prazo;
            previewDiv.style.display = 'block';
            previewDiv.style.borderLeft = `4px solid ${config.cor}`;
        },

        calcularPrazoPorGravidade(gravidade) {
            const prazos = {
                'Baixa': '7 dias √∫teis',
                'M√©dia': '3 dias √∫teis',
                'Alta': '24 horas',
                'Emerg√™ncia': '4 horas'
            };
            return prazos[gravidade] || '3 dias √∫teis';
        },

        getCorGravidade(gravidade) {
            const cores = {
                'Baixa': '#27ae60',
                'M√©dia': '#f39c12',
                'Alta': '#e74c3c',
                'Emerg√™ncia': '#8b0000'
            };
            return cores[gravidade] || '#666';
        },

        getIconeGravidade(gravidade) {
            const icones = {
                'Baixa': 'fa-info-circle',
                'M√©dia': 'fa-exclamation-circle',
                'Alta': 'fa-exclamation-triangle',
                'Emerg√™ncia': 'fa-bell'
            };
            return icones[gravidade] || 'fa-circle';
        },

        adicionarCamposOcultosForm(osId, dataHora, prazoResposta) {
            const form = document.getElementById('os-form-email');
            
            // Remover campos ocultos anteriores (se houver)
            ['os-id', 'data-hora', 'prazo-resposta'].forEach(name => {
                const existing = form.querySelector(`input[name="${name}"]`);
                if (existing) existing.remove();
            });
            
            // Adicionar campos ocultos com informa√ß√µes adicionais
            const camposOcultos = [
                { name: 'os-id', value: osId },
                { name: 'data-hora', value: dataHora },
                { name: 'prazo-resposta', value: prazoResposta },
                { name: 'sistema', value: 'Porter OS System' },
                { name: 'prioridade', value: document.getElementById('os-gravidade').value }
            ];
            
            camposOcultos.forEach(campo => {
                const input = document.createElement('input');
                input.type = 'hidden';
                input.name = campo.name;
                input.value = campo.value;
                form.appendChild(input);
            });
        },

        mostrarConfirmacaoOS(osData) {
            // Ocultar formul√°rio
            document.getElementById('os-form-container').classList.add('hidden');
            
            // Mostrar tela de confirma√ß√£o
            const confirmationScreen = document.getElementById('os-confirmation-screen');
            confirmationScreen.classList.remove('hidden');
            
            // Preencher dados na tela de confirma√ß√£o
            document.getElementById('os-confirmation-id').textContent = osData.osId;
            document.getElementById('os-confirmation-condo').textContent = osData.condo;
            document.getElementById('os-confirmation-gravidade').textContent = osData.gravidade;
            document.getElementById('os-confirmation-funcionario').textContent = osData.funcionario;
            document.getElementById('os-confirmation-email').textContent = osData.email;
            document.getElementById('os-confirmation-data').textContent = `${osData.data} ${osData.hora}`;
            
            // Registrar envio no hist√≥rico
            this.registrarEnvioDetalhadoOS(osData);
        },

        voltarParaFormOS() {
            // Mostrar formul√°rio
            document.getElementById('os-form-container').classList.remove('hidden');
            
            // Ocultar tela de confirma√ß√£o
            document.getElementById('os-confirmation-screen').classList.add('hidden');
            
            // Limpar formul√°rio
            document.getElementById('os-form-email').reset();
            
            // Restaurar cidade
            if (typeof app !== 'undefined' && app.updateCityOS) {
                app.updateCityOS();
            }
            
            // Auto-preenche campos do funcion√°rio se estiver logado
            if (typeof app !== 'undefined' && app.currentUser) {
                document.getElementById('os-funcionario').value = app.currentUser.nome;
                document.getElementById('os-email').value = `${app.currentUser.user}@porter.com.br`;
            }
        },

        registrarEnvioDetalhadoOS(osData) {
            let historico = JSON.parse(localStorage.getItem('porter_os_emails') || '[]');
            
            const registro = {
                id: Date.now(),
                os_id: osData.id,
                os_number: osData.osId,
                data: new Date().toLocaleString('pt-BR'),
                destinatarios: ['londrina.tecnica1@porter.com.br', 'londrina.tecnicaplantao@porter.com.br', 'londrina.tenicaplant√£o1@porter.com.br'],
                condo: osData.condo,
                gravidade: osData.gravidade,
                funcionario: osData.funcionario,
                setor: osData.setor,
                email: osData.email,
                assunto: `[NOVA O.S] - ${osData.setor} - ${osData.funcionario}`,
                sucesso: true,
                data_envio: new Date().toISOString()
            };
            
            historico.unshift(registro);
            if (historico.length > 50) historico.pop();
            localStorage.setItem('porter_os_emails', JSON.stringify(historico));
        },

        gerarCorpoEmailOS(osData) {
            return `========================================
ORDEM DE SERVI√áO - PORTER 2026
========================================

üìã INFORMA√á√ïES DA OS
----------------------------------------
‚Ä¢ N√∫mero: ${osData.osId}
‚Ä¢ Condom√≠nio: ${osData.condo}
‚Ä¢ Cidade: ${osData.cidade}
‚Ä¢ Setor: ${osData.setor}
‚Ä¢ Gravidade: ${osData.gravidade}
‚Ä¢ Prazo: ${osData.prazoResposta || '3 dias √∫teis'}
‚Ä¢ Data OS: ${new Date(osData.dataOS).toLocaleDateString('pt-BR')}
‚Ä¢ T√©cnico respons√°vel: ${osData.tecnicoResponsavel || 'N√£o definido'}

üë§ INFORMA√á√ïES DO SOLICITANTE
----------------------------------------
‚Ä¢ Funcion√°rio: ${osData.funcionario}
‚Ä¢ E-mail: ${osData.email}
‚Ä¢ Operador: ${osData.operador}

üìÖ DATAS E HOR√ÅRIOS
----------------------------------------
‚Ä¢ Aberta em: ${osData.data} √†s ${osData.hora}
‚Ä¢ Turno: ${osData.turno}
‚Ä¢ Status: ${osData.statusOS || 'Em branco'}

üìù DESCRI√á√ÉO DO PROBLEMA/SERVI√áO
----------------------------------------
${osData.desc}

========================================
ATA OPERACIONAL PORTER - 2026
E-mail autom√°tico - N√£o responda
========================================`;
        },

        mostrarDetalhesEmailOS(osData, emails) {
            const corpoEmail = this.gerarCorpoEmailOS(osData);
            
            const modalContent = `
                <div style="padding: 20px; max-width: 800px;">
                    <h3><i class="fas fa-envelope"></i> Detalhes do E-mail da OS</h3>
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin: 15px 0;">
                        <strong><i class="fas fa-paper-plane"></i> De:</strong> sistema@porter.com.br<br>
                        <strong><i class="fas fa-users"></i> Para:</strong> ${emails.join(', ')}<br>
                        <strong><i class="fas fa-tag"></i> Assunto:</strong> [PORTER OS] ${osData.gravidade} - ${osData.condo}
                    </div>
                    <div style="background: white; border: 1px solid #ddd; border-radius: 8px; padding: 20px;
                        margin: 15px 0; font-family: monospace; white-space: pre-wrap;
                        max-height: 300px; overflow-y: auto;">
                        ${corpoEmail}
                    </div>
                    <div style="background: #e8f4fc; padding: 15px; border-radius: 8px; margin: 15px 0;">
                        <i class="fas fa-info-circle"></i> <strong>Nota:</strong>
                        Em produ√ß√£o, este e-mail seria enviado automaticamente para todos os destinat√°rios.
                    </div>
                    <div style="display: flex; gap: 10px; margin-top: 20px;">
                        <button class="btn btn-primary" onclick="app.copiarConteudoEmail()">
                            <i class="fas fa-copy"></i> Copiar Conte√∫do
                        </button>
                        <button class="btn btn-success" onclick="app.abrirClienteEmail('${osData.condo}', '${emails.join(',')}')">
                            <i class="fas fa-envelope-open"></i> Abrir no Cliente de E-mail
                        </button>
                        <button class="btn btn-clear" onclick="app.fecharModalEmail()">
                            Fechar
                        </button>
                    </div>
                </div>
            `;
            
            this.criarModal('Detalhes do E-mail', modalContent);
        },

        criarModal(titulo, conteudo) {
            this.fecharModalEmail();
            
            const modal = document.createElement('div');
            modal.id = 'modal-email-detalhes';
            modal.style.cssText = `
                position: fixed; top: 0; left: 0; width: 100%; height: 100%;
                background: rgba(0,0,0,0.7); display: flex; align-items: center;
                justify-content: center; z-index: 9999; padding: 20px;
            `;
            
            modal.innerHTML = `
                <div style="background: white; border-radius: 12px; max-width: 900px;
                    width: 100%; max-height: 90vh; overflow-y: auto;
                    box-shadow: 0 10px 30px rgba(0,0,0,0.3);">
                    <div style="padding: 20px; border-bottom: 1px solid #eee;">
                        <h3 style="margin: 0; display: flex; justify-content: space-between; align-items: center;">
                            ${titulo}
                            <button onclick="app.fecharModalEmail()" style="background: none; border: none;
                            font-size: 1.5rem; cursor: pointer; color: #666;">&times;</button>
                        </h3>
                    </div>
                    <div>${conteudo}</div>
                </div>
            `;
            
            document.body.appendChild(modal);
        },

        fecharModalEmail() {
            const modal = document.getElementById('modal-email-detalhes');
            if (modal) modal.remove();
        },

        copiarConteudoEmail() {
            const modal = document.getElementById('modal-email-detalhes');
            const conteudo = modal?.querySelector('pre, .conteudo-email')?.innerText || '';
            
            if (conteudo) {
                navigator.clipboard.writeText(conteudo)
                    .then(() => app.showMessage('Conte√∫do copiado!', 'success'))
                    .catch(() => {
                        const textarea = document.createElement('textarea');
                        textarea.value = conteudo;
                        document.body.appendChild(textarea);
                        textarea.select();
                        document.execCommand('copy');
                        document.body.removeChild(textarea);
                        app.showMessage('Conte√∫do copiado!', 'success');
                    });
            }
        },

        abrirClienteEmail(condo, emails) {
            const assunto = encodeURIComponent(`[PORTER OS] ${condo}`);
            const corpo = encodeURIComponent(`Prezado,\n\nSegue Ordem de Servi√ßo do condom√≠nio ${condo}.\n\nAtenciosamente,\nSistema Porter`);
            
            window.open(`mailto:${emails}?subject=${assunto}&body=${corpo}`, '_blank');
            app.showMessage('Cliente de e-mail aberto! Preencha o corpo com os detalhes da OS.', 'info');
        },

        verDetalhesEmailOS(osId) {
            let osList = JSON.parse(localStorage.getItem('porter_os') || '[]');
            let historico = JSON.parse(localStorage.getItem('porter_os_emails') || '[]');
            
            const os = osList.find(o => o.id === osId);
            const envio = historico.find(h => h.os_id === osId);
            
            if (!os) return;
            
            const corpoEmail = this.gerarCorpoEmailOS(os);
            const emails = os.emails || [];
            
            const modalContent = `
                <div style="padding: 20px;">
                    <h3><i class="fas fa-envelope"></i> E-mail da OS - ${os.condo}</h3>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 20px 0;">
                        <div style="background: #f8f9fa; padding: 15px; border-radius: 8px;">
                            <h4><i class="fas fa-info-circle"></i> Informa√ß√µes</h4>
                            <p><strong>Destinat√°rios:</strong> ${emails.length}</p>
                            <p><strong>Gravidade:</strong> ${os.gravidade}</p>
                            <p><strong>Data:</strong> ${os.data} ${os.hora}</p>
                            ${envio ? `<p><strong>Registrado em:</strong> ${envio.data}</p>` : ''}
                        </div>
                        <div style="background: #e8f4fc; padding: 15px; border-radius: 8px;">
                            <h4><i class="fas fa-users"></i> Destinat√°rios</h4>
                            <div style="max-height: 100px; overflow-y: auto;">
                                ${emails.map(email => `<div>üìß ${email}</div>`).join('')}
                            </div>
                        </div>
                    </div>
                    <div style="margin: 20px 0;">
                        <h4><i class="fas fa-file-alt"></i> Conte√∫do do E-mail</h4>
                        <div style="background: white; border: 1px solid #ddd; padding: 15px;
                            border-radius: 6px; font-family: monospace; white-space: pre-wrap;
                            max-height: 300px; overflow-y: auto; margin-top: 10px;">
                            ${corpoEmail}
                        </div>
                    </div>
                    <div style="display: flex; gap: 10px; margin-top: 20px;">
                        <button class="btn btn-primary" onclick="appEmail.copiarConteudoEmail()">
                            <i class="fas fa-copy"></i> Copiar Conte√∫do
                        </button>
                        <button class="btn btn-success" onclick="appEmail.abrirClienteEmail('${os.condo}', '${emails.join(',')}')">
                            <i class="fas fa-envelope-open"></i> Abrir no Cliente de E-mail
                        </button>
                        <button class="btn btn-clear" onclick="appEmail.fecharModalEmail()">
                            Fechar
                        </button>
                    </div>
                </div>
            `;
            
            this.criarModal(`E-mail da OS - ${os.condo}`, modalContent);
        }
    };

    // ==============================================
    // SISTEMA DE PDF (PDF.JS)
    // ==============================================
    const pdfGenerator = {
        generatePDF() {
            const condo = document.getElementById('report-condo').value;
            const dataInicio = document.getElementById('report-data-inicio').value;
            const dataFim = document.getElementById('report-data-fim').value;
            const tipo = document.getElementById('report-tipo').value;
            
            let dados = [];
            let titulo = '';
            
            if (tipo === 'atas' || tipo === 'all') {
                let atas = JSON.parse(localStorage.getItem('porter_atas') || '[]');
                if (condo) atas = atas.filter(a => a.condo === condo);
                if (dataInicio) atas = atas.filter(a => a.dataISO >= dataInicio);
                if (dataFim) atas = atas.filter(a => a.dataISO <= dataFim);
                
                if (tipo === 'atas') {
                    dados = atas;
                    titulo = 'Relat√≥rio de Ocorr√™ncias';
                } else {
                    dados = dados.concat(atas.map(a => ({...a, tipoRegistro: 'Ocorr√™ncia'})));
                }
            }
            
            if (tipo === 'fixas' || tipo === 'all') {
                let atas = JSON.parse(localStorage.getItem('porter_atas') || '[]');
                let fixas = atas.filter(a => a.fixa);
                if (condo) fixas = fixas.filter(a => a.condo === condo);
                if (dataInicio) fixas = fixas.filter(a => a.dataISO >= dataInicio);
                if (dataFim) fixas = fixas.filter(a => a.dataISO <= dataFim);
                
                if (tipo === 'fixas') {
                    dados = fixas;
                    titulo = 'Relat√≥rio de Informa√ß√µes Fixas';
                } else {
                    dados = dados.concat(fixas.map(a => ({...a, tipoRegistro: 'Informa√ß√£o Fixa'})));
                }
            }
            
            if (tipo === 'os' || tipo === 'all') {
                let osList = JSON.parse(localStorage.getItem('porter_os') || '[]');
                if (condo) osList = osList.filter(os => os.condo === condo);
                if (dataInicio) osList = osList.filter(os => os.dataISO >= dataInicio);
                if (dataFim) osList = osList.filter(os => os.dataISO <= dataFim);
                
                if (tipo === 'os') {
                    dados = osList;
                    titulo = 'Relat√≥rio de Ordens de Servi√ßo';
                } else {
                    dados = dados.concat(osList.map(os => ({...os, tipoRegistro: 'Ordem de Servi√ßo'})));
                }
            }
            
            if (tipo === 'all') {
                titulo = 'Relat√≥rio Completo';
            }
            
            if (dados.length === 0) {
                alert('Nenhum registro encontrado para os filtros selecionados.');
                return;
            }
            
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            // Cabe√ßalho
            doc.setFillColor(26, 58, 95);
            doc.rect(0, 0, 210, 30, 'F');
            doc.setTextColor(255, 255, 255);
            doc.setFontSize(20);
            doc.text('PORTER', 105, 15, { align: 'center' });
            doc.setFontSize(12);
            doc.text('Ata Operacional - 2026', 105, 22, { align: 'center' });
            
            // T√≠tulo do relat√≥rio
            doc.setTextColor(0, 0, 0);
            doc.setFontSize(16);
            doc.text(titulo, 105, 40, { align: 'center' });
            
            // Filtros aplicados
            doc.setFontSize(10);
            let filtrosTexto = `Condom√≠nio: ${condo || 'Todos'} | Per√≠odo: ${dataInicio || 'In√≠cio'} a ${dataFim || 'Fim'}`;
            doc.text(filtrosTexto, 105, 50, { align: 'center' });
            
            // Data de gera√ß√£o
            doc.text(`Gerado em: ${new Date().toLocaleDateString('pt-BR')} ${new Date().toLocaleTimeString('pt-BR')}`, 105, 55, { align: 'center' });
            
            // Conte√∫do
            let y = 70;
            
            dados.forEach((item, index) => {
                if (y > 270) {
                    doc.addPage();
                    y = 20;
                }
                
                doc.setFontSize(12);
                doc.setFont(undefined, 'bold');
                doc.text(`${index + 1}. ${item.condo || ''}`, 10, y);
                doc.setFont(undefined, 'normal');
                y += 7;
                
                doc.setFontSize(10);
                doc.text(`Data: ${item.data} ${item.hora} | Tipo: ${item.tipoRegistro || item.tipo || ''}`, 10, y);
                y += 5;
                
                if (item.gravidade) {
                    doc.text(`Gravidade: ${item.gravidade} | Prazo: ${item.prazoResposta || ''}`, 10, y);
                    y += 5;
                }
                
                if (item.statusOS) {
                    doc.text(`Status: ${item.statusOS}`, 10, y);
                    y += 5;
                }
                
                doc.text(`Operador: ${item.operador} | Status: ${item.status || ''}`, 10, y);
                y += 5;
                
                const desc = item.desc || '';
                const descLines = doc.splitTextToSize(desc, 190);
                
                doc.text('Descri√ß√£o:', 10, y);
                y += 5;
                
                descLines.forEach(line => {
                    if (y > 270) {
                        doc.addPage();
                        y = 20;
                    }
                    doc.text(line, 15, y);
                    y += 5;
                });
                
                y += 10;
                
                if (index < dados.length - 1) {
                    doc.setDrawColor(200, 200, 200);
                    doc.line(10, y, 200, y);
                    y += 5;
                }
            });
            
            // Rodap√©
            doc.setFontSize(8);
            doc.setTextColor(100, 100, 100);
            doc.text(`Total de registros: ${dados.length}`, 105, 285, { align: 'center' });
            doc.text('Porter - Ata Operacional 2026', 105, 290, { align: 'center' });
            
            doc.save(`relatorio-porter-${new Date().toISOString().slice(0, 10)}.pdf`);
            app.closeReportModal();
            app.showMessage('Relat√≥rio gerado com sucesso!', 'success');
        }
    };

    // ==============================================
    // APLICA√á√ÉO PRINCIPAL (APP.JS)
    // ==============================================
    const app = {
        currentUser: null,
        selectedMood: null,
        currentCondoFilter: '',
        notifications: [],
        lastLogoffTime: null,
        chatInterval: null,
        privateChatInterval: null,
        moodInterval: null,
        onlineInterval: null,
        onlineUsers: [],
        lastOSId: null,
        currentPrivateChatTarget: null,
        filtrosAtas: {},
        filtrosPresenca: {},

        init() {
            // üîß FIX 2: Restaurar sess√£o ao iniciar
            this.restaurarSessao();
            
            // GARANTIR que come√ßa na tela de login se n√£o houver sess√£o
            if (!this.currentUser) {
                document.getElementById('login-screen').classList.remove('hidden');
                document.getElementById('main-content').classList.add('hidden');
            } else {
                this.showApp();
            }

            // Limpar auto-preenchimento dos campos de login
            setTimeout(() => {
                document.getElementById('login-user').value = '';
                document.getElementById('login-pass').value = '';
                document.getElementById('login-turno').value = 'Diurno';
            }, 100);

            this.loadCondos();
            this.loadFiltros();
            this.loadNotifications();
            this.setupEventListeners();
            this.setupAutoSave();
            this.setupOSPreview();
            this.setupResponsive();

            // Configurar datas padr√£o
            const hoje = new Date();
            const umaSemanaAtras = new Date();
            umaSemanaAtras.setDate(umaSemanaAtras.getDate() - 7);
            
            document.getElementById('filter-data-inicio').value = umaSemanaAtras.toISOString().split('T')[0];
            document.getElementById('filter-data-fim').value = hoje.toISOString().split('T')[0];
            document.getElementById('filter-presenca-inicio').value = umaSemanaAtras.toISOString().split('T')[0];
            document.getElementById('filter-presenca-fim').value = hoje.toISOString().split('T')[0];
            document.getElementById('os-data').value = hoje.toISOString().split('T')[0];

            // Preencher datas do relat√≥rio
            document.getElementById('report-data-inicio').value = umaSemanaAtras.toISOString().split('T')[0];
            document.getElementById('report-data-fim').value = hoje.toISOString().split('T')[0];

            this.carregarFiltrosSalvos();

            // Configurar clique fora da lista de online
            document.addEventListener('click', (e) => {
                const onlineList = document.getElementById('online-users-list');
                const onlineDropdown = document.getElementById('online-users');
                if (onlineList && onlineList.style.display === 'block' &&
                    !onlineDropdown.contains(e.target) &&
                    !onlineList.contains(e.target)) {
                    onlineList.style.display = 'none';
                }
            });

            // Configurar clique fora das notifica√ß√µes
            document.addEventListener('click', (e) => {
                if (!e.target.closest('.notification-bell') && !e.target.closest('.notifications-panel')) {
                    document.getElementById('notifications-panel').classList.remove('show');
                }
            });

            // üîß CORRE√á√ÉO: Inicializar Firebase
            firebaseHelper.inicializarFirebase();
        },

        // üîß FIX 2: NOVA FUN√á√ÉO - Restaurar sess√£o ao iniciar
        restaurarSessao() {
            try {
                // Tentar recuperar sess√£o do localStorage
                const sessaoSalva = localStorage.getItem('porter_session');
                if (sessaoSalva) {
                    const usuario = JSON.parse(sessaoSalva);
                    
                    // Verificar se a sess√£o n√£o expirou (√∫ltimas 24 horas)
                    const ultimaAtividade = new Date(usuario.loginTimestamp || usuario.lastActivity);
                    const agora = new Date();
                    const horasDesdeLogin = (agora - ultimaAtividade) / (1000 * 60 * 60);
                    
                    if (horasDesdeLogin < 24) { // Sess√£o v√°lida por 24 horas
                        this.currentUser = usuario;
                        console.log('‚úÖ Sess√£o restaurada:', usuario.nome);
                        return true;
                    } else {
                        console.log('‚ö†Ô∏è Sess√£o expirada');
                        localStorage.removeItem('porter_session');
                        localStorage.removeItem('porter_last_session');
                    }
                }
            } catch (e) {
                console.log('‚ùå Erro ao restaurar sess√£o:', e);
            }
            return false;
        },

        login() {
    const user = document.getElementById('login-user').value.trim();
    const pass = document.getElementById('login-pass').value;
    const turno = document.getElementById('login-turno').value;
    
    if (!user || !pass) {
        this.showMessage('Preencha usu√°rio e senha!', 'danger');
        return;
    }
    
    // Validar credenciais
    const funcionario = DATA.funcionarios.find(f => 
        f.user === user || f.user === user.toLowerCase()
    );
    
    if (!funcionario) {
        this.showMessage('Usu√°rio n√£o encontrado!', 'danger');
        return;
    }
    
    // Verificar senha (em produ√ß√£o, use hash)
    if (pass !== funcionario.pass) {
        this.showMessage('Senha incorreta!', 'danger');
        return;
    }
    
    // Login bem-sucedido
    this.currentUser = {
        user: funcionario.user,
        nome: funcionario.nome,
        role: funcionario.role,
        turno: turno,
        loginTime: new Date().toISOString(),
        mood: null
    };
    
    // Registrar acesso
    this.registrarAcesso();
    
    // Salvar sess√£o
    this.salvarSessao();
    
    // Atualizar status online
    firebaseHelper.sincronizarStatusOnlineComFirebase();
    
    // Mostrar aplica√ß√£o
    this.showApp();
    
    // Carregar dados
    setTimeout(() => {
        this.loadAtas();
        this.loadOS();
        this.loadNotifications();
        this.updateOnlineUsers();
        this.initMoodCheck();
        chatSystem.loadChat();
        chatSystem.loadPrivateChatUsers();
    }, 100);
    
    this.showMessage(`Bem-vindo(a), ${funcionario.nome}!`, 'success');
}

        setupEventListeners() {
            // Enter no login
            document.getElementById('login-pass').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') this.login();
            });

            // Enter no chat
            document.getElementById('chat-input')?.addEventListener('keypress', (e) => {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    this.sendChatMessage();
                }
            });

            // üîß FIX 1: chat individual - garantir que o evento est√° configurado
            const privateChatSelect = document.getElementById('private-chat-target');
            if (privateChatSelect) {
                // Remover event listeners anteriores para evitar duplica√ß√£o
                privateChatSelect.replaceWith(privateChatSelect.cloneNode(true));
                
                // Recapturar o elemento
                const newSelect = document.getElementById('private-chat-target');
                newSelect.addEventListener('change', (e) => {
                    this.currentPrivateChatTarget = e.target.value;
                    this.loadPrivateChat();
                });
            }

            // Enter no chat privado
            document.getElementById('chat-private-input')?.addEventListener('keypress', (e) => {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    this.sendPrivateChatMessage();
                }
            });

            // Salvar logoff quando a p√°gina for fechada
            window.addEventListener('beforeunload', () => {
                if (this.currentUser) {
                    this.salvarSessao(); // Apenas salvar sess√£o, n√£o registrar logoff
                }
            });

            // üîß FIX 3: bot√£o online - corrigir evento de toggle
            const onlineDropdown = document.getElementById('online-users');
            if (onlineDropdown) {
                onlineDropdown.addEventListener('click', (e) => {
                    e.stopPropagation();
                    this.toggleOnlineUsers();
                });
            }

            // Configurar envio do formul√°rio de OS
            const osForm = document.getElementById('os-form-email');
            if (osForm) {
                osForm.addEventListener('submit', (e) => {
                    this.abrirOSComEmail(e);
                });
            }

            // üîß FIX 2: Recarregar usu√°rios online ao voltar para a p√°gina
            window.addEventListener('pageshow', () => {
                if (this.currentUser) {
                    this.updateOnlineUsers();
                }
            });
        },

        setupAutoSave() {
            setInterval(() => {
                if (this.currentUser) {
                    this.salvarSessao();
                }
            }, 30000);
        },

        setupResponsive() {
            window.addEventListener('resize', () => {
                if (this.currentUser) {
                    if (window.innerWidth > 1200) {
                        document.getElementById('sidebar').style.display = 'block';
                        document.getElementById('sidebar').classList.remove('show');
                    } else {
                        document.getElementById('sidebar').style.display = 'none';
                    }
                }
            });
        },

        setupOSPreview() {
            if (typeof appEmail !== 'undefined' && appEmail.setupOSPreview) {
                appEmail.setupOSPreview();
            }
        },

        setupOnlineTracking() {
            // üîß FIX 3: Atualizar status online a cada 10 segundos (mais frequente)
            this.onlineInterval = setInterval(() => {
                if (this.currentUser) {
                    this.updateOnlineUsers();
                }
            }, 10000);
            // Inicializar imediata
