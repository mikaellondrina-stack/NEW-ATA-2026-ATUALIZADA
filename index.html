<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ata Operacional Porter - 2026</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="styles.css">
    <!-- Adicionando CSS para loading/spinners -->
    <style>
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }
        
        .spinner {
            width: 50px;
            height: 50px;
            border: 5px solid #f3f3f3;
            border-top: 5px solid #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Melhorias de acessibilidade */
        button:focus, input:focus, select:focus, textarea:focus {
            outline: 2px solid #3498db;
            outline-offset: 2px;
        }
        
        /* Modal de confirma√ß√£o para logout */
        .confirmation-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 10000;
        }
        
        .confirmation-content {
            background: white;
            padding: 2rem;
            border-radius: 10px;
            max-width: 400px;
            width: 90%;
            text-align: center;
        }
        
        /* Indicador de campos obrigat√≥rios */
        .required-field::after {
            content: " *";
            color: #e74c3c;
        }
        
        /* Bot√£o de backup */
        .backup-btn {
            background: linear-gradient(45deg, #9b59b6, #8e44ad) !important;
            color: white !important;
        }
    </style>
</head>
<body>

<!-- Overlay de loading -->
<div class="loading-overlay" id="loading-overlay">
    <div class="spinner"></div>
    <div style="color: white; margin-top: 1rem;">Processando...</div>
</div>

<!-- Modal de confirma√ß√£o para logout -->
<div class="confirmation-modal" id="logout-confirmation">
    <div class="confirmation-content">
        <h3><i class="fas fa-sign-out-alt"></i> Confirmar Sa√≠da</h3>
        <p>Tem certeza que deseja sair do sistema?</p>
        <div style="display: flex; gap: 10px; margin-top: 1.5rem; justify-content: center;">
            <button class="btn btn-primary" onclick="app.confirmLogout(true)">
                <i class="fas fa-check"></i> Sim, Sair
            </button>
            <button class="btn btn-clear" onclick="app.confirmLogout(false)">
                <i class="fas fa-times"></i> Cancelar
            </button>
        </div>
    </div>
</div>

<!-- TELA DE LOGIN -->
<section id="login-screen">
    <div class="login-container">
        <div class="login-logo">
            <div class="login-logo-img" role="img" aria-label="Logo Porter"></div>
            <h1>Ata Operacional Porter</h1>
            <p>Sistema de Registro de Ocorr√™ncias - 2026</p>
        </div>
        
        <!-- Formul√°rio de login com valida√ß√£o -->
        <form id="login-form" onsubmit="return app.validateLogin()">
            <div class="form-group input-icon">
                <i class="fas fa-user"></i>
                <input type="text" id="login-user" placeholder="nome.sobrenome" autocomplete="off" 
                       required pattern="[a-zA-Z]+\.[a-zA-Z]+" 
                       title="Formato: nome.sobrenome"
                       aria-label="Nome de usu√°rio no formato nome.sobrenome">
                <div class="input-error" id="login-user-error" style="display: none; color: #e74c3c; font-size: 0.8rem; margin-top: 5px;">
                    <i class="fas fa-exclamation-circle"></i> Formato inv√°lido. Use: nome.sobrenome
                </div>
            </div>
            <div class="form-group input-icon">
                <i class="fas fa-lock"></i>
                <input type="password" id="login-pass" placeholder="********" autocomplete="off" 
                       required minlength="6"
                       aria-label="Senha de acesso">
                <div class="input-error" id="login-pass-error" style="display: none; color: #e74c3c; font-size: 0.8rem; margin-top: 5px;">
                    <i class="fas fa-exclamation-circle"></i> Senha deve ter pelo menos 6 caracteres
                </div>
            </div>
            <div class="form-group input-icon">
                <i class="fas fa-clock"></i>
                <select id="login-turno" required aria-label="Turno de trabalho">
                    <option value="">Selecione o turno...</option>
                    <option value="Diurno">Diurno</option>
                    <option value="Noturno">Noturno</option>
                </select>
                <div class="input-error" id="login-turno-error" style="display: none; color: #e74c3c; font-size: 0.8rem; margin-top: 5px;">
                    <i class="fas fa-exclamation-circle"></i> Selecione um turno
                </div>
            </div>
            <button type="submit" class="btn btn-primary">
                <i class="fas fa-sign-in-alt"></i> ACESSAR SISTEMA
            </button>
        </form>
        
        <div style="margin-top: 1.5rem; text-align: center; font-size: 0.8rem; color: var(--gray);">
            <i class="fas fa-info-circle"></i> Use suas credenciais fornecidas pela Porter
        </div>
    </div>
</section>

<!-- SIDEBAR COM LISTA DE CONDOM√çNIOS -->
<div id="sidebar" role="navigation" aria-label="Lista de condom√≠nios">
    <div class="sidebar-header">
        <h3><i class="fas fa-building"></i> CONDOM√çNIOS</h3>
        <button class="sidebar-toggle" onclick="app.toggleSidebar()" aria-label="Fechar menu lateral">
            <i class="fas fa-times"></i>
        </button>
    </div>
    <div class="condo-list" id="condo-list">
        <!-- Lista de condom√≠nios ser√° gerada dinamicamente -->
    </div>
    
    <!-- Bot√£o de backup/exporta√ß√£o (vis√≠vel apenas para admin) -->
    <div id="sidebar-backup" style="display: none; padding: 1rem; border-top: 1px solid #eee;">
        <button class="btn btn-sm backup-btn" onclick="app.openBackupModal()" style="width: 100%;">
            <i class="fas fa-database"></i> Backup de Dados
        </button>
    </div>
</div>

<!-- CONTE√öDO PRINCIPAL -->
<div id="main-content" class="hidden">
    <header role="banner">
        <div class="header-left">
            <button class="mobile-toggle" onclick="app.toggleSidebar()" aria-label="Abrir menu lateral">
                <i class="fas fa-bars"></i>
            </button>
            <div class="header-logo">
                <div class="logo-porter" role="img" aria-label="Logo Porter"></div>
                <div class="header-logo-text">
                    <strong>ATA OPERACIONAL PORTER</strong>
                    <div>Sistema de Registro de Ocorr√™ncias - 2026</div>
                </div>
            </div>
        </div>
        
        <!-- √ÅREA DE INFORMA√á√ïES DO USU√ÅRIO -->
        <div id="user-info">
            <!-- Ser√° preenchido dinamicamente com informa√ß√µes do login -->
        </div>
        
        <div style="display: flex; align-items: center; gap: 15px;">
            <!-- OPERADORES ONLINE -->
            <div id="online-users" class="online-users-dropdown" role="button" tabindex="0" 
                 onclick="app.toggleOnlineUsers()" onkeypress="if(event.key === 'Enter') app.toggleOnlineUsers()">
                <i class="fas fa-users" style="color: white;"></i>
                <span style="font-size: 0.9rem;">
                    <span id="online-count">0</span> online
                </span>
                <i class="fas fa-chevron-down" style="font-size: 0.8rem;"></i>
                <div id="online-users-list" class="online-users-list"></div>
            </div>
            
            <!-- Notifica√ß√µes -->
            <div class="notification-bell" onclick="app.toggleNotifications()" role="button" tabindex="0" 
                 onkeypress="if(event.key === 'Enter') app.toggleNotifications()">
                <i class="fas fa-bell"></i>
                <span class="notification-badge" id="notification-count" style="display: none;">0</span>
                <div class="notifications-panel" id="notifications-panel">
                    <div class="notification-header">
                        <strong><i class="fas fa-bell"></i> Notifica√ß√µes</strong>
                        <button class="btn btn-clear btn-sm" onclick="app.clearNotifications()">Limpar</button>
                    </div>
                    <div id="notifications-list"></div>
                </div>
            </div>
            
            <!-- Bot√£o Contato E-mail -->
            <button id="email-button" class="btn btn-success">
                <i class="fas fa-envelope"></i> Contato
            </button>
            
            <!-- Bot√£o Relat√≥rio -->
            <button class="btn btn-success" onclick="app.openReportModal()">
                <i class="fas fa-file-pdf"></i> Relat√≥rio
            </button>
            
            <!-- Bot√£o Backup/Exporta√ß√£o -->
            <div id="backup-controls" style="display: none;">
                <button class="btn backup-btn" onclick="app.openBackupModal()">
                    <i class="fas fa-database"></i> Backup
                </button>
            </div>
            
            <!-- Bot√£o Admin (apenas para admin) -->
            <div id="admin-controls" class="admin-controls" style="display: none;">
                <button class="btn btn-warning" onclick="app.openAdminPanel()">
                    <i class="fas fa-user-shield"></i> Admin
                </button>
            </div>
            
            <!-- Bot√£o Sair -->
            <button class="btn btn-accent" onclick="app.showLogoutConfirmation()">
                <i class="fas fa-sign-out-alt"></i> Sair
            </button>
        </div>
    </header>

    <div class="tabs" role="tablist">
        <button class="tab-btn active" onclick="app.switchTab('tab-ata', this)" 
                role="tab" aria-selected="true" id="tab-ata-btn">
            <i class="fas fa-file-alt"></i> ATA DE OCORR√äNCIAS
            <span class="tab-badge" id="tab-count-ata">0</span>
        </button>
        <button class="tab-btn" onclick="app.switchTab('tab-fixas', this)" 
                role="tab" aria-selected="false" id="tab-fixas-btn">
            <i class="fas fa-thumbtack"></i> INFORMA√á√ïES FIXAS
            <span class="tab-badge" id="tab-count-fixas">0</span>
        </button>
        <button class="tab-btn" onclick="app.switchTab('tab-os', this)" 
                role="tab" aria-selected="false" id="tab-os-btn">
            <i class="fas fa-tools"></i> ORDEM DE SERVI√áO
            <span class="tab-badge" id="tab-count-os">0</span>
        </button>
        <!-- NOVA ABA: CHAT GERAL -->
        <button class="tab-btn chat-tab" onclick="app.switchTab('tab-chat', this)" 
                role="tab" aria-selected="false" id="tab-chat-btn">
            <i class="fas fa-comments"></i> CHAT GERAL
            <span class="chat-badge" id="chat-badge">0</span>
        </button>
        <button class="tab-btn" onclick="app.switchTab('tab-presenca', this)" 
                role="tab" aria-selected="false" id="tab-presenca-btn">
            <i class="fas fa-users"></i> HIST√ìRICO
        </button>
    </div>

    <div class="container">
        <!-- Componente de Avalia√ß√£o de Humor -->
        <div id="mood-check-container" class="mood-check-container hidden">
            <div class="mood-title">
                <i class="fas fa-heart"></i> Como voc√™ est√° se sentindo hoje?
            </div>
            <div class="mood-subtitle">
                Selecione a express√£o que melhor representa seu estado emocional atual
            </div>
            
            <div class="mood-options" id="mood-options">
                <!-- As op√ß√µes ser√£o geradas via JavaScript -->
            </div>
            
            <div class="mood-status" id="mood-status">
                <i class="fas fa-mouse-pointer"></i> Clique em uma express√£o para selecionar
            </div>
            
            <div class="mood-submit">
                <button class="btn btn-primary" onclick="app.enviarMood()" id="mood-submit-btn" disabled>
                    <i class="fas fa-paper-plane"></i> Enviar Meu Sentimento
                </button>
            </div>
            
            <div id="mood-result" class="mood-result hidden"></div>
        </div>

        <!-- ABA: ATA DE OCORR√äNCIAS -->
        <div id="tab-ata" class="tab-content" role="tabpanel" aria-labelledby="tab-ata-btn">
            <!-- Filtros -->
            <div class="filters-container">
                <div class="filters-title">
                    <i class="fas fa-filter"></i> Filtrar Registros
                </div>
                <div class="grid-3">
                    <div class="form-group">
                        <label><i class="fas fa-building"></i> Condom√≠nio</label>
                        <select id="filter-condo">
                            <option value="">Todos os condom√≠nios</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label><i class="fas fa-calendar"></i> Data Inicial</label>
                        <input type="date" id="filter-data-inicio">
                    </div>
                    <div class="form-group">
                        <label><i class="fas fa-calendar"></i> Data Final</label>
                        <input type="date" id="filter-data-fim">
                    </div>
                    <div class="form-group">
                        <label><i class="fas fa-tag"></i> Tipo</label>
                        <select id="filter-tipo">
                            <option value="">Todos os tipos</option>
                            <option value="Informa√ß√£o">üìù Informa√ß√£o</option>
                            <option value="Ocorr√™ncia">‚ö†Ô∏è Ocorr√™ncia</option>
                            <option value="Incidente">üö® Incidente</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label><i class="fas fa-tasks"></i> Status</label>
                        <select id="filter-status">
                            <option value="">Todos os status</option>
                            <option value="Em andamento">üîÑ Em andamento</option>
                            <option value="Finalizado">‚úÖ Finalizado</option>
                        </select>
                    </div>
                    <div class="filter-actions">
                        <button class="btn btn-filter" onclick="app.aplicarFiltrosAtas()">
                            <i class="fas fa-search"></i> Filtrar
                        </button>
                        <button class="btn btn-clear" onclick="app.limparFiltrosAtas()">
                            <i class="fas fa-times"></i> Limpar
                        </button>
                        <!-- Bot√£o para salvar filtro -->
                        <button class="btn btn-success btn-sm" onclick="app.salvarFiltro('ata')" id="save-filter-btn">
                            <i class="fas fa-save"></i> Salvar Filtro
                        </button>
                    </div>
                </div>
                <div id="filtros-ativos-ata" class="filter-info"></div>
                <!-- Filtros salvos -->
                <div id="saved-filters-ata" class="saved-filters" style="margin-top: 10px;"></div>
            </div>

            <div id="resultados-info-ata" style="margin-bottom: 1rem;"></div>

            <!-- Formul√°rio Nova Ata -->
            <div class="form-card fade-in">
                <h2><i class="fas fa-plus-circle"></i> Novo Registro de Ocorr√™ncia</h2>
                <form id="form-ata" onsubmit="return app.validateAtaForm()">
                    <div class="grid-2">
                        <div class="form-group">
                            <label class="required-field"><i class="fas fa-building"></i> Condom√≠nio</label>
                            <select id="ata-condo" onchange="app.updateCity()" required>
                                <option value="">Selecione um condom√≠nio...</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label><i class="fas fa-city"></i> Cidade</label>
                            <input type="text" id="ata-cidade" readonly style="background: #f8f9fa;">
                        </div>
                    </div>
                    <div class="grid-2">
                        <div class="form-group">
                            <label class="required-field"><i class="fas fa-tag"></i> Tipo de Registro</label>
                            <select id="ata-tipo" required>
                                <option value="">Selecione um tipo...</option>
                                <option value="Informa√ß√£o">üìù Informa√ß√£o</option>
                                <option value="Ocorr√™ncia">‚ö†Ô∏è Ocorr√™ncia</option>
                                <option value="Incidente">üö® Incidente</option>
                                <option value="Informa√ß√µes Fixas">üìå Informa√ß√µes Fixas</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="required-field"><i class="fas fa-tasks"></i> Status</label>
                            <select id="ata-status" required>
                                <option value="">Selecione um status...</option>
                                <option value="Em andamento">üîÑ Em andamento</option>
                                <option value="Finalizado">‚úÖ Finalizado</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="required-field"><i class="fas fa-align-left"></i> Descri√ß√£o dos Fatos</label>
                        <textarea id="ata-desc" rows="5" placeholder="Descreva detalhadamente os fatos ocorridos..." required></textarea>
                    </div>
                    <button type="submit" class="btn btn-primary" id="save-ata-btn">
                        <i class="fas fa-save"></i> SALVAR REGISTRO
                    </button>
                </form>
            </div>

            <!-- Lista de Atas -->
            <div id="ata-lista"></div>
        </div>

        <!-- ABA: INFORMA√á√ïES FIXAS -->
        <div id="tab-fixas" class="tab-content hidden" role="tabpanel" aria-labelledby="tab-fixas-btn">
            <div class="fixed-info-container">
                <div class="fixed-info-header">
                    <i class="fas fa-thumbtack"></i>
                    <h3>Informa√ß√µes Fixas dos Condom√≠nios</h3>
                </div>
                <p style="color: #856404; margin-bottom: 1rem;">
                    <i class="fas fa-info-circle"></i> Estas s√£o informa√ß√µes importantes que permanecem vis√≠veis para todos os operadores.
                </p>
            </div>
            
            <div id="fixas-lista"></div>
        </div>

        <!-- ABA: ORDEM DE SERVI√áO -->
        <div id="tab-os" class="tab-content hidden" role="tabpanel" aria-labelledby="tab-os-btn">
            <!-- Formul√°rio OS -->
            <div class="form-card os-form fade-in">
                <h2><i class="fas fa-tools"></i> Nova Ordem de Servi√ßo</h2>
                <form id="form-os" onsubmit="return app.validateOSForm()">
                    <div class="grid-2">
                        <div class="form-group">
                            <label class="required-field"><i class="fas fa-building"></i> Condom√≠nio</label>
                            <select id="os-condo" onchange="app.updateCityOS()" required>
                                <option value="">Selecione um condom√≠nio...</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label><i class="fas fa-city"></i> Cidade</label>
                            <input type="text" id="os-cidade" readonly style="background: #f8f9fa;">
                        </div>
                    </div>
                    <div class="grid-2">
                        <!-- NOVO CAMPO: GRAVIDADE -->
                        <div class="form-group">
                            <label class="required-field"><i class="fas fa-exclamation-triangle"></i> Gravidade da Ocorr√™ncia</label>
                            <select id="os-gravidade" required>
                                <option value="">Selecione a gravidade...</option>
                                <option value="Baixa">üü¢ Baixa - Manuten√ß√£o Preventiva/Rotina</option>
                                <option value="M√©dia">üü° M√©dia - Reparo Necess√°rio</option>
                                <option value="Alta">üî¥ Alta - Urgente/Problema Cr√≠tico</option>
                                <option value="Emerg√™ncia">üö® Emerg√™ncia - Risco Imediato</option>
                            </select>
                            <small style="font-size: 0.8rem; color: #666;">Define prioridade e tempo de resposta</small>
                        </div>
                        <div class="form-group">
                            <label><i class="fas fa-calendar"></i> Data Preferencial</label>
                            <input type="date" id="os-data">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="required-field"><i class="fas fa-align-left"></i> Descri√ß√£o do Servi√ßo</label>
                        <textarea id="os-desc" rows="5" placeholder="Descreva detalhadamente o servi√ßo necess√°rio..." required></textarea>
                    </div>
                    <!-- ATUALIZADO: E-MAILS M√öLTIPLOS -->
                    <div class="form-group">
                        <label><i class="fas fa-envelope"></i> E-mails para Notifica√ß√£o (separados por v√≠rgula)</label>
                        <input type="text" id="os-emails" placeholder="tecnica@porter.com, sindico@condominio.com, adm@empresa.com">
                        <small style="font-size: 0.8rem; color: #666;">Separe m√∫ltiplos e-mails por v√≠rgula</small>
                    </div>
                    
                    <!-- VISUALIZA√á√ÉO DA PRIORIDADE -->
                    <div id="os-preview-prioridade" style="margin: 1rem 0; padding: 1rem; background: #f8f9fa; border-radius: 8px; display: none;">
                        <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 8px;">
                            <div id="os-preview-icone" style="font-size: 1.2rem;"></div>
                            <div>
                                <strong id="os-preview-gravidade"></strong>
                                <div style="font-size: 0.85rem; color: #666;" id="os-preview-prazo"></div>
                            </div>
                        </div>
                        <div style="font-size: 0.85rem; color: #666;">
                            <i class="fas fa-info-circle"></i> Esta OS ser√° tratada com prioridade correspondente
                        </div>
                    </div>
                    
                    <button type="submit" class="btn btn-info" id="save-os-btn">
                        <i class="fas fa-paper-plane"></i> ENVIAR ORDEM DE SERVI√áO
                    </button>
                </form>
            </div>

            <!-- NOVO: FILTRO POR GRAVIDADE NA LISTA -->
            <div style="margin: 2rem 0 1rem 0; display: flex; justify-content: space-between; align-items: center;">
                <h3><i class="fas fa-list"></i> Ordens de Servi√ßo</h3>
                <div style="display: flex; gap: 10px;">
                    <div class="btn-group">
                        <button class="btn btn-filter" onclick="app.filtrarOSTodas()">
                            Todas
                        </button>
                        <button class="btn btn-filter" style="background: #e74c3c20; color: #e74c3c; border: 1px solid #e74c3c40;" 
                                onclick="app.filtrarOSGravidade('Alta')">
                            üî¥ Alta
                        </button>
                        <button class="btn btn-filter" style="background: #f39c1220; color: #f39c12; border: 1px solid #f39c1240;" 
                                onclick="app.filtrarOSGravidade('M√©dia')">
                            üü° M√©dia
                        </button>
                        <button class="btn btn-filter" style="background: #27ae6020; color: #27ae60; border: 1px solid #27ae6040;" 
                                onclick="app.filtrarOSGravidade('Baixa')">
                            üü¢ Baixa
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Lista de OS -->
            <div id="os-lista"></div>
        </div>

        <!-- NOVA ABA: CHAT GERAL -->
        <div id="tab-chat" class="tab-content hidden" role="tabpanel" aria-labelledby="tab-chat-btn">
            <div class="chat-container">
                <div class="chat-header">
                    <div>
                        <strong><i class="fas fa-comments"></i> Chat Geral dos Operadores</strong>
                        <div style="font-size: 0.85rem; opacity: 0.9;">Comunica√ß√£o r√°pida entre a equipe</div>
                    </div>
                    <div class="chat-admin-controls" id="chat-admin-controls" style="display: none;">
                        <button class="chat-clear-btn" onclick="app.clearChat()">
                            <i class="fas fa-trash"></i> Limpar Chat
                        </button>
                        <button class="chat-clear-btn" onclick="app.openChatModeration()">
                            <i class="fas fa-user-shield"></i> Moderar
                        </button>
                    </div>
                </div>
                
                <div class="chat-messages" id="chat-messages" role="log" aria-live="polite">
                    <!-- Mensagens ser√£o carregadas aqui -->
                </div>
                
                <div class="chat-input-area">
                    <textarea class="chat-input" id="chat-input" placeholder="Digite sua mensagem..." rows="2"></textarea>
                    <button class="btn btn-info" onclick="app.sendChatMessage()" id="chat-send-btn">
                        <i class="fas fa-paper-plane"></i> Enviar
                    </button>
                </div>
            </div>
            
            <div style="margin-top: 1rem; font-size: 0.85rem; color: var(--gray); text-align: center;">
                <i class="fas fa-info-circle"></i> As mensagens s√£o vis√≠veis para todos os operadores logados
            </div>
        </div>

        <!-- ABA: HIST√ìRICO -->
        <div id="tab-presenca" class="tab-content hidden" role="tabpanel" aria-labelledby="tab-presenca-btn">
            <div class="filters-container">
                <div class="filters-title">
                    <i class="fas fa-filter"></i> Filtrar Hist√≥rico
                </div>
                <div class="grid-3">
                    <div class="form-group">
                        <label><i class="fas fa-user"></i> Operador</label>
                        <select id="filter-presenca-operador">
                            <option value="">Todos os operadores</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label><i class="fas fa-calendar"></i> Data Inicial</label>
                        <input type="date" id="filter-presenca-inicio">
                    </div>
                    <div class="form-group">
                        <label><i class="fas fa-calendar"></i> Data Final</label>
                        <input type="date" id="filter-presenca-fim">
                    </div>
                    <div class="form-group">
                        <label><i class="fas fa-clock"></i> Turno</label>
                        <select id="filter-presenca-turno">
                            <option value="">Todos os turnos</option>
                            <option value="Diurno">üåû Diurno</option>
                            <option value="Noturno">üåô Noturno</option>
                        </select>
                    </div>
                    <div class="filter-actions">
                        <button class="btn btn-filter" onclick="app.aplicarFiltrosPresenca()">
                            <i class="fas fa-search"></i> Filtrar
                        </button>
                        <button class="btn btn-clear" onclick="app.limparFiltrosPresenca()">
                            <i class="fas fa-times"></i> Limpar
                        </button>
                    </div>
                </div>
            </div>

            <!-- Hist√≥rico de Acesso -->
            <h3 style="margin: 2rem 0 1rem 0;"><i class="fas fa-history"></i> Hist√≥rico de Acesso</h3>
            <div style="overflow-x: auto;">
                <table role="grid">
                    <thead>
                        <tr>
                            <th><i class="fas fa-user"></i> Operador</th>
                            <th><i class="fas fa-clock"></i> Turno</th>
                            <th><i class="fas fa-calendar"></i> Data</th>
                            <th><i class="fas fa-sign-in-alt"></i> Login</th>
                            <th><i class="fas fa-sign-out-alt"></i> Logoff</th>
                        </tr>
                    </thead>
                    <tbody id="presenca-lista"></tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<!-- MODAL DE E-MAIL -->
<div class="modal" id="email-modal">
    <div class="modal-content email-modal-content">
        <div class="modal-header">
            <h3><i class="fas fa-envelope"></i> Enviar E-mail para a T√©cnica</h3>
            <button class="modal-close" onclick="emailApp.closeEmailModal()">&times;</button>
        </div>
        <div class="email-form-container">
            <div class="form-group">
                <label><i class="fas fa-user"></i> Seu Nome</label>
                <input type="text" id="email-sender-name" placeholder="Digite seu nome completo" required>
            </div>
            
            <div class="form-group">
                <label><i class="fas fa-building"></i> Condom√≠nio (opcional)</label>
                <input type="text" id="email-condominio" placeholder="Nome do condom√≠nio relacionado">
            </div>
            
            <div class="form-group">
                <label><i class="fas fa-tag"></i> Assunto</label>
                <input type="text" id="email-subject" placeholder="Assunto do e-mail" required>
            </div>
            
            <div class="form-group">
                <label><i class="fas fa-edit"></i> Mensagem</label>
                <textarea id="email-message" rows="8" placeholder="Descreva detalhadamente o assunto..." required></textarea>
            </div>
            
            <!-- Informa√ß√£o sobre destinat√°rios -->
            <div style="margin: 1rem 0; padding: 1rem; background: #e8f4fc; border-radius: 8px;">
                <i class="fas fa-info-circle"></i> <strong>Destinat√°rios:</strong>
                <div style="font-size: 0.85rem; margin-top: 5px;">
                    ‚Ä¢ londrina.tecnica1@porter.com.br<br>
                    ‚Ä¢ londrina.tecnicaplantao@porter.com.br<br>
                    ‚Ä¢ londrina.tecnicaplantao1@porter.com.br
                </div>
            </div>
            
            <!-- CAPTCHA b√°sico anti-spam -->
            <div class="captcha-container">
                <div class="captcha-question" id="captcha-question">
                    <!-- Ser√° gerado dinamicamente -->
                </div>
                <input type="text" class="captcha-input" id="captcha-answer" placeholder="Resposta" required>
                <small style="display: block; margin-top: 8px; color: #666;">
                    <i class="fas fa-shield-alt"></i> Verifica√ß√£o de seguran√ßa
                </small>
            </div>
            
            <!-- Status do envio -->
            <div class="email-status" id="email-status"></div>
            
            <div style="display: flex; gap: 10px; margin-top: 1.5rem;">
                <button class="btn btn-primary" onclick="emailApp.sendEmail()" id="email-send-btn">
                    <i class="fas fa-paper-plane"></i> Enviar E-mail
                </button>
                <button class="btn btn-clear" onclick="emailApp.closeEmailModal()">
                    Cancelar
                </button>
            </div>
            
            <div style="margin-top: 1.5rem; padding: 1rem; background: #f8f9fa; border-radius: 8px; font-size: 0.9rem;">
                <i class="fas fa-envelope"></i> 
                <strong>Informa√ß√£o:</strong> Este e-mail ser√° enviado diretamente do sistema Porter para a equipe t√©cnica.
                Voc√™ receber√° uma c√≥pia no e-mail do sistema.
            </div>
        </div>
    </div>
</div>

<!-- MODAL DE RELAT√ìRIO -->
<div class="modal" id="report-modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3><i class="fas fa-file-pdf"></i> Gerar Relat√≥rio PDF</h3>
            <button class="modal-close" onclick="app.closeReportModal()">&times;</button>
        </div>
        <div class="form-group">
            <label><i class="fas fa-building"></i> Condom√≠nio</label>
            <select id="report-condo">
                <option value="">Todos os condom√≠nios</option>
            </select>
        </div>
        <div class="grid-2">
            <div class="form-group">
                <label><i class="fas fa-calendar"></i> Data Inicial</label>
                <input type="date" id="report-data-inicio">
            </div>
            <div class="form-group">
                <label><i class="fas fa-calendar"></i> Data Final</label>
                <input type="date" id="report-data-fim">
            </div>
        </div>
        <div class="form-group">
            <label><i class="fas fa-tag"></i> Tipo de Conte√∫do</label>
            <select id="report-tipo">
                <option value="atas">üìã Ocorr√™ncias</option>
                <option value="fixas">üìå Informa√ß√µes Fixas</option>
                <option value="os">üîß Ordens de Servi√ßo</option>
                <option value="all">üìä Todos os Registros</option>
            </select>
        </div>
        <div class="pdf-preview" id="pdf-preview">
            <div class="pdf-icon">
                <i class="fas fa-file-pdf"></i>
            </div>
            <p>Selecione as op√ß√µes e gere o relat√≥rio</p>
            <p style="font-size: 0.9rem; color: var(--gray);">O relat√≥rio ser√° gerado em PDF para impress√£o</p>
        </div>
        <div style="display: flex; gap: 10px; margin-top: 1.5rem;">
            <button class="btn btn-primary" onclick="app.generatePDF()">
                <i class="fas fa-download"></i> Gerar e Baixar PDF
            </button>
            <button class="btn btn-clear" onclick="app.closeReportModal()">
                Cancelar
            </button>
        </div>
    </div>
</div>

<!-- MODAL DE CONTROLE ADMIN -->
<div class="modal" id="admin-modal">
  <div class="modal-content">
    <div class="modal-header">
      <h3>
        <i class="fas fa-user-shield"></i>
        Controle Administrativo
      </h3>
      <button class="modal-close" onclick="app.closeAdminModal()">
        &times;
      </button>
    </div>

    <div id="admin-modal-content">
      <!-- Conte√∫do ser√° carregado dinamicamente -->
    </div>
  </div>
</div>

<!-- MODAL DE BACKUP/EXPORTA√á√ÉO -->
<div class="modal" id="backup-modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3><i class="fas fa-database"></i> Backup e Exporta√ß√£o de Dados</h3>
            <button class="modal-close" onclick="app.closeBackupModal()">&times;</button>
        </div>
        <div style="padding: 1rem;">
            <p>Selecione o formato para exportar os dados do sistema:</p>
            
            <div class="grid-2" style="margin: 1.5rem 0;">
                <button class="btn btn-success" onclick="app.exportData('json')">
                    <i class="fas fa-file-code"></i> Exportar JSON
                </button>
                <button class="btn btn-info" onclick="app.exportData('csv')">
                    <i class="fas fa-file-csv"></i> Exportar CSV
                </button>
                <button class="btn btn-warning" onclick="app.exportData('excel')">
                    <i class="fas fa-file-excel"></i> Exportar Excel
                </button>
                <button class="btn btn-primary" onclick="app.exportData('pdf')">
                    <i class="fas fa-file-pdf"></i> Exportar PDF
                </button>
            </div>
            
            <div style="margin-top: 1.5rem; padding: 1rem; background: #f8f9fa; border-radius: 8px;">
                <h4><i class="fas fa-info-circle"></i> Informa√ß√µes:</h4>
                <ul style="font-size: 0.9rem;">
                    <li><strong>JSON:</strong> Formato completo para backup e restaura√ß√£o</li>
                    <li><strong>CSV:</strong> Para an√°lise em planilhas simples</li>
                    <li><strong>Excel:</strong> Formato .xlsx com formata√ß√£o</li>
                    <li><strong>PDF:</strong> Relat√≥rio estruturado para impress√£o</li>
                </ul>
            </div>
            
            <div style="margin-top: 1.5rem; font-size: 0.85rem; color: #666;">
                <i class="fas fa-shield-alt"></i> Os dados exportados cont√™m apenas informa√ß√µes n√£o sens√≠veis do sistema.
            </div>
        </div>
    </div>
</div>

<!-- MODAL DE MODERA√á√ÉO DO CHAT -->
<div class="modal" id="chat-moderation-modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3><i class="fas fa-user-shield"></i> Modera√ß√£o do Chat</h3>
            <button class="modal-close" onclick="app.closeChatModeration()">&times;</button>
        </div>
        <div style="padding: 1rem;">
            <h4>√öltimas mensagens:</h4>
            <div id="chat-moderation-list" style="max-height: 300px; overflow-y: auto; margin: 1rem 0; padding: 1rem; background: #f8f9fa; border-radius: 8px;">
                <!-- Lista de mensagens para modera√ß√£o -->
            </div>
            
            <div class="form-group">
                <label><i class="fas fa-user"></i> Bloquear Usu√°rio (opcional)</label>
                <input type="text" id="block-user" placeholder="Nome do usu√°rio a bloquear">
            </div>
            
            <div style="display: flex; gap: 10px; margin-top: 1.5rem;">
                <button class="btn btn-danger" onclick="app.deleteSelectedMessages()">
                    <i class="fas fa-trash"></i> Apagar Selecionadas
                </button>
                <button class="btn btn-warning" onclick="app.blockUser()">
                    <i class="fas fa-ban"></i> Bloquear Usu√°rio
                </button>
                <button class="btn btn-clear" onclick="app.closeChatModeration()">
                    Fechar
                </button>
            </div>
        </div>
    </div>
</div>

<!-- ==================== -->
<!-- SCRIPTS NA ORDEM CORRETA -->
<!-- ==================== -->

<!-- 1. Firebase SDK (PRIMEIRO) -->
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>

<!-- 2. Outras bibliotecas -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
<!-- Biblioteca para exportar Excel -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

<!-- 3. Sua configura√ß√£o Firebase (SEGUNDO) -->
<script src="firebase.js"></script>

<!-- 4. Seus dados e scripts (TERCEIRO) -->
<script src="data.js"></script>
<script src="aplicativo-email.js"></script>
<script src="app.js"></script>

</body>
</html>
